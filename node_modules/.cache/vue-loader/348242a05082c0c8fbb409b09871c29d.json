{"remainingRequest":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tianfeng/Desktop/BackUp with listeners/app/src/views/Community.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/src/views/Community.vue","mtime":1636813262785},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovLyA8dGVtcGxhdGU+DQovLyAgIDxkaXYgaWQ9ImFwcCI+DQovLyAgICAgPGRpdiBpZD0ibmF2Ij4NCi8vICAgICAgIDxyb3V0ZXItbGluayB0bz0iLyI+SG9tZTwvcm91dGVyLWxpbms+IHwNCi8vICAgICAgIDxyb3V0ZXItbGluayB0bz0iL2Fib3V0Ij5BYm91dDwvcm91dGVyLWxpbms+DQovLyAgICAgPC9kaXY+DQovLyAgICAgPHJvdXRlci12aWV3Lz4NCi8vICAgPC9kaXY+DQovLyA8L3RlbXBsYXRlPg0KLy88SGVsbG9Xb3JsZCBtc2c9IldlbGNvbWUgdG8gWW91ciBWdWUuanMgQXBwIi8+DQovL2ltcG9ydCBIZWxsb1dvcmxkIGZyb20gJy4vY29tcG9uZW50cy9IZWxsb1dvcmxkLnZ1ZScNCmltcG9ydCB7IGdldEF1dGggLCBvbkF1dGhTdGF0ZUNoYW5nZWQsIHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkLHVwZGF0ZVBhc3N3b3JkfSBmcm9tICJmaXJlYmFzZS9hdXRoIjsNCmltcG9ydCB7IGdldERvY3MgLGdldEZpcmVzdG9yZSAsY29sbGVjdGlvbiwgc2V0RG9jICxkb2Msb25TbmFwc2hvdH0gZnJvbSAiZmlyZWJhc2UvZmlyZXN0b3JlIjsgDQppbXBvcnQge2dldFN0b3JhZ2UgLCByZWYsIHVwbG9hZEJ5dGVzLCBnZXREb3dubG9hZFVSTH0gZnJvbSAiZmlyZWJhc2Uvc3RvcmFnZSI7DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdhcHAnLA0KICBkYXRhKCl7DQogICAgcmV0dXJuIHsNCiAgICAgIHRhc2tJdGVtOlsNCiAgICAgICAgICAvLyB7DQogICAgICAgICAgLy8gICB0YXNrSWQgOiAxLA0KICAgICAgICAgIC8vICAgdGFza0Rlc2M6ICJUaGlzIGlzIHRhc2sgMSIsDQogICAgICAgICAgLy8gICB0YXNrRHVlOiAiMTEvOC8yMDIxIiwNCiAgICAgICAgICAvLyAgIHRhc2tUaW1lOiAiIg0KICAgICAgICAgIC8vIH0sDQogICAgICAgICAgLy8gew0KICAgICAgICAgIC8vICAgdGFza0lkIDogMiwNCiAgICAgICAgICAvLyAgIHRhc2tEZXNjOiAiVGhpcyBpcyB0YXNrIDIiLA0KICAgICAgICAgIC8vICAgdGFza0R1ZTogIjExLzgvMjAyMSIsDQogICAgICAgICAgLy8gICB0YXNrVGltZTogIiINCiAgICAgICAgICAvLyB9DQogICAgICBdLA0KICAgICAgbmV3VGFza0l0ZW06ew0KDQogICAgICAgIG5ld1Rhc2tEZXNjIDogIiIsDQogICAgICAgIG5ld1Rhc2tEdWVEYXRlIDogIiIsDQogICAgICAgIG5ld1Rhc2tEdWVUaW1lIDogIiIsDQogICAgICAgIA0KICAgICAgfSwNCiAgICAgIC8vbW9kYWxzIA0KICAgICAgc2hvd01vZGFsIDogZmFsc2UsIC8vZm9yIG5ldyB0YXNrDQogICAgICBzaG93U2VhcmNoRnJpZW5kIDogZmFsc2UsDQogICAgICBzaG93RnJpZW5kSW5mbzogZmFsc2UsDQogICAgICBzaG93UHJvZmlsZSA6ZmFsc2UsDQoNCiAgICAgIC8vc2VhcmNoDQogICAgICBzZWFyY2hFbWFpbCA6ICIiLA0KICAgICAgc2VhcmNoVXNlciA6IG51bGwsDQoNCiAgICAgIC8vZXJyb3JzDQogICAgICBuZXdUYXNrRXJyb3I6IGZhbHNlLA0KDQogICAgICAvL2ZyaWVuZHMNCiAgICAgIG15RnJpZW5kczogW10sDQogICAgICBteUZyaWVuZFJlcXVlc3QgOltdLA0KICAgICAgZnJpZW5kSW5mbyA6IG51bGwsDQogICAgICBwaG90b0xpbmsgOiBbDQogICAgICAiaHR0cHM6Ly9ib290ZGV5LmNvbS9pbWcvQ29udGVudC9hdmF0YXIvYXZhdGFyMS5wbmciLA0KICAgICAgImh0dHBzOi8vYm9vdGRleS5jb20vaW1nL0NvbnRlbnQvYXZhdGFyL2F2YXRhcjIucG5nIiwNCiAgICAgICJodHRwczovL2Jvb3RkZXkuY29tL2ltZy9Db250ZW50L2F2YXRhci9hdmF0YXIzLnBuZyIsDQogICAgICAiaHR0cHM6Ly9ib290ZGV5LmNvbS9pbWcvQ29udGVudC9hdmF0YXIvYXZhdGFyNC5wbmciLA0KICAgICAgImh0dHBzOi8vYm9vdGRleS5jb20vaW1nL0NvbnRlbnQvYXZhdGFyL2F2YXRhcjUucG5nIiwNCiAgICAgICJodHRwczovL2Jvb3RkZXkuY29tL2ltZy9Db250ZW50L2F2YXRhci9hdmF0YXI2LnBuZyIsDQogICAgICAiaHR0cHM6Ly9ib290ZGV5LmNvbS9pbWcvQ29udGVudC9hdmF0YXIvYXZhdGFyNy5wbmciLA0KICAgICAgImh0dHBzOi8vYm9vdGRleS5jb20vaW1nL0NvbnRlbnQvYXZhdGFyL2F2YXRhcjgucG5nIg0KICAgICAgXSwNCiAgICAgIC8vY3VycmVudFVzZXINCiAgICAgIHVzZXIgOiBudWxsLA0KDQogICAgICAvL2NvbW11bml0eSBwb3N0DQogICAgICBwaG90b1BhdGggOiBudWxsLA0KICAgICAgcG9zdE1lc3NhZ2UgOiAiIiwNCiAgICAgIGFsbFBvc3QgOiBbXSwNCiAgICAgIG15UG9zdDogMCwNCiAgICAgIHBpY3RVcmwgOiAiIiwNCiAgICAgIG5vUHVibGlzaENvbnRlbnQ6IGZhbHNlLA0KICAgICAgLy9Db21tZW50DQogICAgICBuZXdDb21tZW50IDogIiIsDQoNCiAgICAgIC8vY2hhbmdlUGFzc3dvcmQNCiAgICAgIGVkaXQgOiBmYWxzZSwNCiAgICAgIHNhdmVCdG4gOiBmYWxzZSwNCiAgICAgIG9sZFB3IDogIiIsDQogICAgICBuZXdQdyA6ICIiLA0KICAgICAgbmV3VXNlcm5hbWUgOiAiIiwNCiAgICAgIG5ld1VzZXJuYW1lRXJyb3IgOiBmYWxzZSwNCiAgICAgIHVwZGF0ZVBhc3N3b3JkRXJyb3IgOiBmYWxzZSwNCiAgICAgIHNlbGVjdGVkSW1nIDogIiINCiAgICB9DQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICAvL0hlbGxvV29ybGQsDQogIH0sDQogIG1ldGhvZHM6ew0KICAgIGFkZE5ld1Rhc2soKXsNCiAgICAgIGNvbnNvbGUubG9nKHRoaXMubmV3VGFza0l0ZW0pDQogICAgICB2YXIgaXRlbSA9IHsNCiAgICAgICAgICAgIC8vdGFza0lkIDogdGhpcy50YXNrSXRlbS5sZW5ndGggKyAxLA0KICAgICAgICAgICAgdGFza0Rlc2M6IHRoaXMubmV3VGFza0l0ZW0ubmV3VGFza0Rlc2MsDQogICAgICAgICAgICB0YXNrRHVlOiB0aGlzLm5ld1Rhc2tJdGVtLm5ld1Rhc2tEdWVEYXRlLA0KICAgICAgICAgICAgdGFza1RpbWU6IHRoaXMubmV3VGFza0l0ZW0ubmV3VGFza0R1ZVRpbWUNCiAgICAgIH0NCg0KICAgICAgdGhpcy50YXNrSXRlbS5wdXNoKGl0ZW0pDQogICAgICB0aGlzLnNob3dNb2RhbCA9IGZhbHNlOw0KDQogICAgICAvL3VwZGF0ZSB0aGUgZGF0YWJhc2UNCiAgICAgIHZhciB1cGRhdGVkSXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudGFza0l0ZW0pOw0KICAgICAgLy9jb25zb2xlLmxvZyh1cGRhdGVkSXRlbSk7DQogICAgICB2YXIgcHJvbWlzZSA9IHVwZGF0ZURiVGFza0l0ZW0odGhpcy51c2VyVWlkLHVwZGF0ZWRJdGVtKTsNCiAgICAgIHByb21pc2UudGhlbigoKT0+ew0KICAgICAgICBjb25zb2xlLmxvZygiU3VjY2VzcyIpOw0KICAgICAgICB0aGlzLm5ld1Rhc2tJdGVtLm5ld1Rhc2tEZXNjID0gIiI7DQogICAgICAgIHRoaXMubmV3VGFza0l0ZW0ubmV3VGFza0R1ZURhdGUgPSAiIjsNCiAgICAgICAgdGhpcy5uZXdUYXNrSXRlbS5uZXdUYXNrRHVlVGltZSA9ICIiOw0KICAgICAgICB0aGlzLm5ld1Rhc2tFcnJvciA9IGZhbHNlOw0KICAgICAgfSkNCiAgICAgIA0KICAgIH0sDQogICAgcmVtb3ZlVGFzayhpZCl7DQogICAgICB0aGlzLnRhc2tJdGVtID0gdGhpcy50YXNrSXRlbS5maWx0ZXIoKGl0ZW0sa2V5KT0+a2V5ICE9IGlkKTsNCiAgICAgICAgICAgIC8vdXBkYXRlIHRoZSBkYXRhYmFzZQ0KICAgICAgdmFyIHVwZGF0ZWRJdGVtID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy50YXNrSXRlbSk7DQogICAgICAvL2NvbnNvbGUubG9nKHVwZGF0ZWRJdGVtKTsNCiAgICAgIHZhciBwcm9taXNlID0gdXBkYXRlRGJUYXNrSXRlbSh0aGlzLnVzZXJVaWQsdXBkYXRlZEl0ZW0pOw0KICAgICAgcHJvbWlzZS50aGVuKCgpPT57DQogICAgICAgIGNvbnNvbGUubG9nKCJTdWNjZXNzIik7DQogICAgICAgIHRoaXMubmV3VGFza0l0ZW0ubmV3VGFza0Rlc2MgPSAiIjsNCiAgICAgICAgdGhpcy5uZXdUYXNrSXRlbS5uZXdUYXNrRHVlRGF0ZSA9ICIiOw0KICAgICAgICB0aGlzLm5ld1Rhc2tJdGVtLm5ld1Rhc2tEdWVUaW1lID0gIiI7DQogICAgICAgIHRoaXMubmV3VGFza0Vycm9yID0gZmFsc2U7DQogICAgICB9KQ0KICAgIH0sDQogICAgc2hvd05ld1Rhc2tFcnJvcigpew0KICAgICAgdGhpcy5uZXdUYXNrRXJyb3IgPSB0cnVlOw0KICAgIH0sDQogICAgZmluZFVzZXIoKXsNCiAgICAgIGNvbnNvbGUubG9nKHRoaXMuc2VhcmNoRW1haWwpOw0KICAgICAgdmFyIHVzZXJJbmZvID0gZ2V0U2VhcmNoVXNlcih0aGlzLnNlYXJjaEVtYWlsKTsNCiAgICAgIHVzZXJJbmZvLnRoZW4oKHVzZXIpPT57DQogICAgICAgIGlmKHVzZXIpew0KICAgICAgICAgIHRoaXMuc2VhcmNoVXNlciA9IHVzZXI7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgIHRoaXMuc2VhcmNoVXNlciA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgfSk7DQogICAgfSwNCiAgICBzZW5kRnJpZW5kUmVxdWVzdCgpew0KICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zZWFyY2hVc2VyKTsNCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudXNlcikNCiAgICAgIHZhciB1cGRhdGVkUmVxdWVzdCA9IFtdOw0KICAgICAgdmFyIGFsbFJlcXVlc3QgPSBnZXREYXRhKHRoaXMuc2VhcmNoVXNlci51aWQsImZyaWVuZHJlcXVlc3QiKTsNCiAgICAgICAgYWxsUmVxdWVzdC50aGVuKChyZXN1bHQpPT57DQogICAgICAgICAgaWYocmVzdWx0ICE9IG51bGwpew0KICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsNCiAgICAgICAgICAgICAgcmVzdWx0ID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQpOw0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpOw0KICAgICAgICAgICAgICBmb3IobGV0IGl0ZW0gb2YgcmVzdWx0KXsNCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGl0ZW0pDQogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB7DQogICAgICAgICAgICAgICAgICB1aWQgOiBpdGVtLnVpZCwNCiAgICAgICAgICAgICAgICAgIGVtYWlsIDogaXRlbS5lbWFpbCwNCiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogaXRlbS51c2VybmFtZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB1cGRhdGVkUmVxdWVzdC5wdXNoKHRlbXApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHVwZGF0ZWRSZXF1ZXN0LnB1c2godGhpcy51c2VyKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICB1cGRhdGVkUmVxdWVzdC5wdXNoKHRoaXMudXNlcik7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyByZXF1ZXN0IikNCiAgICAgICAgICAgIH0gDQogICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICB1cGRhdGVkUmVxdWVzdC5wdXNoKHRoaXMudXNlcik7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gcmVxdWVzdCBsaXN0Iik7DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciByZXNwb25zZSA9IHNlbmREYkZyaWVuZFJlcXVlc3QodXBkYXRlZFJlcXVlc3QsdGhpcy5zZWFyY2hVc2VyKTsNCiAgICAgICAgICByZXNwb25zZS50aGVuKCgpPT57DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJmcmllbmQgcmVxdWVzdCBzZW5kIik7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pOyANCg0KICAgIH0sDQogICAgcHJvY2Vzc0ZyaWVuZFJlcXVlc3QoZnJpZW5kLGlkLGFjdGlvbil7DQogICAgICAvL2FjdGlvbiB0cnVlIC0+IGFjY2VwdA0KICAgICAgLy9hY3Rpb24gZmFsc2UgLT4gcmVqZWN0DQogICAgICB0aGlzLm15RnJpZW5kUmVxdWVzdCA9IHRoaXMubXlGcmllbmRSZXF1ZXN0LmZpbHRlcigocmVxdWVzdCxrZXkpPT5rZXkgIT0gaWQpOw0KDQogICAgICAvL3VwZGF0ZSB0aGUgZGF0YWJhc2UNCiAgICAgIC8vdmFyIHVwZGF0ZVJlcXVlc3QgPSBPYmplY3QuYXNzaWduKHt9LHRoaXMubXlGcmllbmRSZXF1ZXN0KTsNCiAgICAgIHZhciBwcm9taXNlID0gc2VuZERiRnJpZW5kUmVxdWVzdCh0aGlzLm15RnJpZW5kUmVxdWVzdCx0aGlzLnVzZXIpOw0KICAgICAgcHJvbWlzZS50aGVuKCgpPT57DQogICAgICAgIGlmKGFjdGlvbiA9PSB0cnVlKXsNCiAgICAgICAgICBjb25zb2xlLmxvZygiRnJpZW5kIFJlcXVlc3QgYWNjZXB0ZWQgISIpOw0KICAgICAgICAgIHRoaXMubXlGcmllbmRzLnB1c2goZnJpZW5kKTsNCg0KICAgICAgICAgIC8vdXBkYXRlIGRhdGFiYXNlIGZyaWVuZCBsaXN0IGZvciBjdXJyZW50IHVzZXINCiAgICAgICAgICB2YXIgaXRlbXMgPSB1cGRhdGVEYkZyaWVuZHModGhpcy51c2VyLnVpZCx0aGlzLm15RnJpZW5kcyk7DQogICAgICAgICAgaXRlbXMudGhlbigoKT0+ew0KICAgICAgICAgICAgY29uc29sZS5sb2coIkZyaWVuZCBsaXN0IHVwZGF0ZWQhIik7DQogICAgICAgICAgfSk7DQogICAgICAgICAgLy91cGRhdGUgZGF0YWJhc2UgZnJpZW5kIGxpc3QgZm9yIGZyaWVuZA0KICAgICAgICAgIHZhciB1cGRhdGVkRnJpZW5kTGlzdEl0ZW1zID1bXTsNCiAgICAgICAgICB2YXIgZnJpZW5kTGlzdEl0ZW1zID0gZ2V0RGF0YShmcmllbmQudWlkLCJmcmllbmRzIik7DQogICAgICAgICAgZnJpZW5kTGlzdEl0ZW1zLnRoZW4oKHJlc3VsdCk9PnsNCiAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7DQogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApew0KICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgZm9yKGxldCBpdGVtIG9mIHJlc3VsdCl7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKQ0KICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gew0KICAgICAgICAgICAgICAgICAgdWlkIDogaXRlbS51aWQsDQogICAgICAgICAgICAgICAgICBlbWFpbCA6IGl0ZW0uZW1haWwsDQogICAgICAgICAgICAgICAgICB1c2VybmFtZSA6IGl0ZW0udXNlcm5hbWUsDQogICAgICAgICAgICAgICAgICBwcm9maWxlUGljIDogaXRlbS5wcm9maWxlUGljDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHVwZGF0ZWRGcmllbmRMaXN0SXRlbXMucHVzaCh0ZW1wKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB1cGRhdGVkRnJpZW5kTGlzdEl0ZW1zLnB1c2godGhpcy51c2VyKQ0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgIHVwZGF0ZWRGcmllbmRMaXN0SXRlbXMucHVzaCh0aGlzLnVzZXIpDQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBGcmllbmRzIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgdXBkYXRlZEZyaWVuZExpc3RJdGVtcy5wdXNoKHRoaXMudXNlcikNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBGcmllbmRsaXN0Iik7DQogICAgICAgICAgfQ0KICAgICAgICAgIGl0ZW1zID0gdXBkYXRlRGJGcmllbmRzKGZyaWVuZC51aWQsdXBkYXRlZEZyaWVuZExpc3RJdGVtcyk7DQogICAgICAgICAgaXRlbXMudGhlbigoKT0+ew0KICAgICAgICAgICAgY29uc29sZS5sb2coIkZyaWVuZCBsaXN0IHVwZGF0ZWQhIik7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pOyANCg0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICBjb25zb2xlLmxvZygiRnJpZW5kIFJlcXVlc3QgcmVqZWN0ZWQgISIpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGRlbGV0ZUZyaWVuZCh1bmZyaWVuZCl7DQogICAgICB0aGlzLm15RnJpZW5kcyA9IHRoaXMubXlGcmllbmRzLmZpbHRlcigoZnJpZW5kKT0+ZnJpZW5kLmVtYWlsICE9IHVuZnJpZW5kLmVtYWlsKTsNCg0KICAgICAgLy9kZWxldGUgZm9yIGN1cnJlbnQgdXNlcg0KICAgICAgdmFyIHByb21pc2UgPSB1cGRhdGVEYkZyaWVuZHModGhpcy51c2VyLnVpZCx0aGlzLm15RnJpZW5kcyk7DQogICAgICBwcm9taXNlLnRoZW4oKCk9PnsNCiAgICAgICAgY29uc29sZS5sb2coIkZyaWVuZCBsaXN0IHVwZGF0ZWQhIik7DQoNCiAgICAgICAgICAvL2dldCB0YXJnZXQgdW5mcmllbmQNCiAgICAgICAgICB2YXIgdXBkYXRlZEZyaWVuZExpc3RJdGVtcyA9W107DQogICAgICAgICAgdmFyIGZyaWVuZExpc3RJdGVtcyA9IGdldERhdGEodW5mcmllbmQudWlkLCJmcmllbmRzIik7DQogICAgICAgICAgZnJpZW5kTGlzdEl0ZW1zLnRoZW4oKHJlc3VsdCk9PnsNCiAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7DQogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApew0KICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgZm9yKGxldCBpdGVtIG9mIHJlc3VsdCl7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKQ0KICAgICAgICAgICAgICAgIGlmKGl0ZW0uZW1haWwgIT0gdGhpcy51c2VyLmVtYWlsKXsNCiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gew0KICAgICAgICAgICAgICAgICAgICB1aWQgOiBpdGVtLnVpZCwNCiAgICAgICAgICAgICAgICAgICAgZW1haWwgOiBpdGVtLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA6IGl0ZW0udXNlcm5hbWUNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIHVwZGF0ZWRGcmllbmRMaXN0SXRlbXMucHVzaCh0ZW1wKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGl0ZW1zID0gdXBkYXRlRGJGcmllbmRzKHVuZnJpZW5kLnVpZCx1cGRhdGVkRnJpZW5kTGlzdEl0ZW1zKTsNCiAgICAgICAgICBpdGVtcy50aGVuKCgpPT57DQogICAgICAgICAgICBjb25zb2xlLmxvZygiRnJpZW5kIGxpc3QgdXBkYXRlZCEiKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9LA0KICAgIGdldEZyaWVuZEluZm8oZnJpZW5kKXsNCiAgICAgICAgdGhpcy5mcmllbmRJbmZvID0gZnJpZW5kOw0KICAgIH0sDQogICAgc2VsZWN0SW1nKCl7DQogICAgICAvLyB2YXIgSW1nTmFtZSwgSW1nVXJsOw0KICAgIA0KICAgICAgLy8gdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaGlkZGVuU2VsZWN0SW1nIik7DQogICAgICANCiAgICAgIGlucHV0Lm9uY2hhbmdlID0gZSA9PnsNCiAgICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXM7DQogICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKXsNCiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlpbWciKS5zcmMgPSByZWFkZXIucmVzdWx0Ow0KICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJteWltZyIpLnN0eWxlID0gImRpc3BsYXk6YmxvY2s7aGVpZ2h0OjEwMHB4O3dpZHRoOjEwMHB4OyBib3JkZXI6MXB4IHNvbGlkIGJsYWNrIjsNCiAgICAgICAgfQ0KICAgICAgICAvL2NvbnNvbGUubG9nKGZpbGVzWzBdLm5hbWUpOw0KICAgICAgICB0aGlzLnBob3RvUGF0aCA9IGZpbGVzWzBdOw0KICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlc1swXSk7DQogICAgICB9DQogICAgICBpbnB1dC5jbGljaygpOw0KICAgIH0sDQogICAgcHVibGlzaFBvc3QoKXsNCg0KICAgICAgdmFyIGRvd25sb2FkVXJsID0gIiI7DQogICAgICB2YXIgc3RvcmFnZSA9IGdldFN0b3JhZ2UoKTsNCiAgICAgIGlmKHRoaXMucGhvdG9QYXRoICE9IG51bGwpew0KICAgICAgICANCiAgICAgICAgZG93bmxvYWRVcmwgPSAiaW1hZ2VzLyIrdGhpcy5waG90b1BhdGgubmFtZTsNCiAgICAgICAgdmFyIHBob3RvUmVmID0gcmVmKHN0b3JhZ2UsZG93bmxvYWRVcmwpOw0KICAgICAgICANCiAgICAgICAgdXBsb2FkQnl0ZXMocGhvdG9SZWYsdGhpcy5waG90b1BhdGgpLnRoZW4oKHNuYXBzaG90KT0+ew0KICAgICAgICAgIGNvbnNvbGUubG9nKHNuYXBzaG90KTsNCiAgICAgICAgfSk7DQoNCiAgICAgIH0NCiAgICAgIHZhciBnZXRVcmwgPSBnZXREb3dubG9hZFVSTChyZWYoc3RvcmFnZSxkb3dubG9hZFVybCkpOw0KICAgICAgZ2V0VXJsLnRoZW4oKHVybCk9PnsNCiAgICAgICAgICB2YXIgbmV3UG9zdCA9IHsNCiAgICAgICAgICBkb3dubG9hZFVybCA6IHVybCwNCiAgICAgICAgICBwb3N0TWVzc2FnZSA6IHRoaXMucG9zdE1lc3NhZ2UsDQogICAgICAgICAgdWlkIDogdGhpcy51c2VyLnVpZCwNCiAgICAgICAgICBlbWFpbCA6IHRoaXMudXNlci5lbWFpbCwNCiAgICAgICAgICB1c2VybmFtZSA6IHRoaXMudXNlci51c2VybmFtZSwNCiAgICAgICAgICBkYXRlIDogbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKSwNCiAgICAgICAgICBjb21tZW50cyA6IFtdLA0KICAgICAgICAgIHByb2ZpbGVQaWMgOiB0aGlzLnVzZXIucHJvZmlsZVBpYw0KICAgICAgICB9DQogICAgICAgIHRoaXMucHJvY2Vzc1B1Ymxpc2gobmV3UG9zdCk7DQogICAgICB9KS5jYXRjaCgoKT0+ew0KICAgICAgICAgIHZhciBuZXdQb3N0ID0gew0KICAgICAgICAgIGRvd25sb2FkVXJsIDogIiIsDQogICAgICAgICAgcG9zdE1lc3NhZ2UgOiB0aGlzLnBvc3RNZXNzYWdlLA0KICAgICAgICAgIHVpZCA6IHRoaXMudXNlci51aWQsDQogICAgICAgICAgZW1haWwgOiB0aGlzLnVzZXIuZW1haWwsDQogICAgICAgICAgdXNlcm5hbWUgOiB0aGlzLnVzZXIudXNlcm5hbWUsDQogICAgICAgICAgZGF0ZSA6IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCksDQogICAgICAgICAgY29tbWVudHMgOiBbXSwNCiAgICAgICAgICBwcm9maWxlUGljIDogdGhpcy51c2VyLnByb2ZpbGVQaWMNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnByb2Nlc3NQdWJsaXNoKG5ld1Bvc3QpOw0KICAgICAgfSk7ICAgICANCiAgICB9LA0KICAgIHJlbW92ZVBob3RvKCl7DQogICAgICB0aGlzLnBob3RvUGF0aCA9IG51bGw7DQogICAgICB0aGlzLnBpY3RVcmwgPSAiIjsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJteWltZyIpLnNyYyA9ICIiOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm15aW1nIikuc3R5bGUgPSAiZGlzcGxheTpub25lOyI7DQogICAgfSwNCiAgICBwcm9jZXNzUHVibGlzaChuZXdQb3N0KXsNCiAgICAgIHZhciB1cGRhdGVQb3N0ID0gW10NCiAgICAgIHZhciBpdGVtcyA9IGdldERhdGEoImFsbHBvc3QiLCJwb3N0Iik7DQogICAgICBpdGVtcy50aGVuKChyZXN1bHQpPT57DQogICAgICAgICAgaWYocmVzdWx0ICE9IG51bGwpew0KICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsNCiAgICAgICAgICAgICAgcmVzdWx0ID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQpOw0KICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7DQogICAgICAgICAgICAgIGZvcihsZXQgaXRlbSBvZiByZXN1bHQpew0KICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaXRlbSkNCiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IHsNCiAgICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsIDogaXRlbS5kb3dubG9hZFVybCwNCiAgICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlIDogaXRlbS5wb3N0TWVzc2FnZSwNCiAgICAgICAgICAgICAgICAgIHVpZCA6IGl0ZW0udWlkLA0KICAgICAgICAgICAgICAgICAgZW1haWwgOiBpdGVtLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgOiBpdGVtLnVzZXJuYW1lLA0KICAgICAgICAgICAgICAgICAgZGF0ZSA6IGl0ZW0uZGF0ZSwNCiAgICAgICAgICAgICAgICAgIHByb2ZpbGVQaWMgOiBpdGVtLnByb2ZpbGVQaWMNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdXBkYXRlUG9zdC5wdXNoKHRlbXApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIEZyaWVuZHMiKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gRnJpZW5kbGlzdCIpOw0KICAgICAgICAgIH0NCiAgICAgICAgICB1cGRhdGVQb3N0LnB1c2gobmV3UG9zdCk7DQogICAgICAgICAgdmFyIHByb21pc2UgPSB1cGRhdGVEYlBvc3QodXBkYXRlUG9zdCk7DQogICAgICAgICAgcHJvbWlzZS50aGVuKCgpPT57DQogICAgICAgICAgICBjb25zb2xlLmxvZygiUG9zdCBVcGRhdGVkIik7DQogICAgICAgICAgfSkNCiAgICAgIH0pOyANCiAgICAgIHRoaXMucGhvdG9QYXRoID0gbnVsbDsNCiAgICAgIHRoaXMucG9zdE1lc3NhZ2UgID0gIiI7DQogICAgICB0aGlzLnBpY3RVcmwgPSAiIjsNCiAgICAgIC8vdGhpcy5hbGxQb3N0LnVuc2hpZnQobmV3UG9zdCk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlpbWciKS5zcmMgPSAiIjsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJteWltZyIpLnN0eWxlID0gImRpc3BsYXk6bm9uZTsiOw0KICAgIH0sDQogICAgcHJvY2Vzc0NvbW1lbnQoa2V5KXsNCiAgICAgIHRoaXMuYWxsUG9zdFtrZXldLmNvbW1lbnRzLnB1c2godGhpcy5uZXdDb21tZW50KTsNCiAgICAgIHZhciB0ZW1wID0gdGhpcy5hbGxQb3N0Ow0KICAgICAgdXBkYXRlRGJQb3N0KHRlbXApLnRoZW4oKCk9PnsNCiAgICAgICAgY29uc29sZS5sb2coIkNvbW1lbnQgdXBkYXRlZCIpOw0KICAgICAgfSk7DQogICAgICB0aGlzLm5ld0NvbW1lbnQgPSAiIjsNCiAgICB9LA0KICAgIHVwZGF0ZVVzZXJuYW1lKCl7DQogICAgICB0aGlzLm5ld1VzZXJuYW1lRXJyb3IgPSBmYWxzZTsNCiAgICAgIHZhciBkYiA9IGdldEZpcmVzdG9yZSgpOw0KICAgICAgdmFyIHVzZXJSZWYgPSBkb2MoZGIsInVzZXJzIix0aGlzLnVzZXIudWlkKTsNCg0KICAgICAgaWYodGhpcy5uZXdVc2VybmFtZS50cmltKCk9PSIiKXsNCiAgICAgICAgaWYodGhpcy5zZWxlY3RlZEltZyAhPSAiIil7DQogICAgICAgICAgICBzZXREb2ModXNlclJlZix7cHJvZmlsZVBpYzp0aGlzLnNlbGVjdGVkSW1nfSx7bWVyZ2U6dHJ1ZX0pLnRoZW4oKCk9PnsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJVc2VybmFtZSB1cGRhdGVkIik7DQogICAgICAgICAgICB0aGlzLnVzZXIucHJvZmlsZVBpYyA9IHRoaXMuc2VsZWN0ZWRJbWc7DQogICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW1nID0gIiI7DQogICAgICAgICAgICB0aGlzLnNob3dQcm9maWxlID0gZmFsc2U7DQogICAgICAgICAgfSk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubmV3VXNlcm5hbWVFcnJvciA9IHRydWU7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KDQogICAgICAgIHNldERvYyh1c2VyUmVmLHt1c2VybmFtZTp0aGlzLm5ld1VzZXJuYW1lfSx7bWVyZ2U6dHJ1ZX0pLnRoZW4oKCk9PnsNCiAgICAgICAgY29uc29sZS5sb2coIlVzZXJuYW1lIHVwZGF0ZWQiKTsNCiAgICAgICAgdGhpcy51c2VyLnVzZXJuYW1lID0gdGhpcy5uZXdVc2VybmFtZTsNCiAgICAgICAgdGhpcy5uZXdVc2VybmFtZSA9ICIiOw0KICAgICAgICB0aGlzLnNob3dQcm9maWxlID0gZmFsc2U7DQogICAgICB9KTsNCg0KICAgIH0sDQogICAgY2hhbmdlUGFzc3dvcmQoKXsNCiAgICAgIHZhciBhdXRoID0gZ2V0QXV0aCgpOw0KICAgICAgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCx0aGlzLnVzZXIuZW1haWwsdGhpcy5vbGRQdykudGhlbigoKT0+ew0KICAgICAgICAgIC8vY29ycmVjdCBwYXNzd29yZA0KICAgICAgICAgIHZhciB1c2VyID0gYXV0aC5jdXJyZW50VXNlcjsNCiAgICAgICAgICB1cGRhdGVQYXNzd29yZCh1c2VyLHRoaXMubmV3UHcpLnRoZW4oKCk9PnsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQYXNzd29yZCB1cGRhdGVkIik7DQogICAgICAgICAgICB0aGlzLm5ld1B3ID0gIiI7DQogICAgICAgICAgICB0aGlzLm9sZFB3ID0gIiI7DQogICAgICAgICAgfSk7DQogICAgICB9KS5jYXRjaCgoKT0+ew0KICAgICAgICAgIHRoaXMudXBkYXRlUGFzc3dvcmRFcnJvciA9IHRydWU7DQogICAgICAgICAgdGhpcy5uZXdQdyA9ICIiOw0KICAgICAgICAgIHRoaXMub2xkUHcgPSAiIjsNCiAgICAgIH0pDQogICAgfSwNCiAgICB0b01lc3NhZ2UoKXsNCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiL01lc3NhZ2VzIjsNCiAgICB9LA0KDQogIH0sDQogIGJlZm9yZUNyZWF0ZSgpew0KICAgIGNvbnN0IGF1dGggPSBnZXRBdXRoKCk7DQogICAgb25BdXRoU3RhdGVDaGFuZ2VkKGF1dGgsICh1c2VyKSA9PiB7DQogICAgaWYgKHVzZXIpIHsNCiAgICAgICAgLy8gVXNlciBpcyBzaWduZWQgaW4sIHNlZSBkb2NzIGZvciBhIGxpc3Qgb2YgYXZhaWxhYmxlIHByb3BlcnRpZXMNCiAgICAgICAgLy8gaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvcmVmZXJlbmNlL2pzL2ZpcmViYXNlLlVzZXINCiAgICAgICAgY29uc29sZS5sb2codXNlci5lbWFpbCk7DQogICAgICAgIHZhciB1c2VySW5mbyA9IGdldFNlYXJjaFVzZXIodXNlci5lbWFpbCk7DQogICAgICAgIHVzZXJJbmZvLnRoZW4oKHVzZXIpPT57DQogICAgICAgICAgdGhpcy51c2VyPXVzZXI7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLnVzZXJVaWQgPSB1c2VyLnVpZDsgLy9sb2cgdGhlIHVpZCBpbiB2dWUNCg0KICAgICAgICAvL1N0YXJ0IGdldHRpbmcgdGFza2xpc3QNCiAgICAgICAgdmFyIGl0ZW1zID0gZ2V0RGF0YSh0aGlzLnVzZXJVaWQsInRhc2tsaXN0Iik7IA0KICAgICAgICBpdGVtcy50aGVuKChyZXN1bHQpPT57IC8vaGFuZGxlcyB0aGUgcHJvbWlzZQ0KICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7DQogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9MCl7DQogICAgICAgICAgICAgIHJlc3VsdCA9IE9iamVjdC52YWx1ZXMocmVzdWx0KTsNCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpOw0KICAgICAgICAgICAgICBmb3IobGV0IGl0ZW0gb2YgcmVzdWx0KXsNCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKTsNCiAgICAgICAgICAgICAgdmFyIHRlbXAgPSB7DQogICAgICAgICAgICAgICAgdGFza0Rlc2M6IGl0ZW0udGFza0Rlc2MsDQogICAgICAgICAgICAgICAgdGFza0R1ZTogaXRlbS50YXNrRHVlLA0KICAgICAgICAgICAgICAgIHRhc2tUaW1lOiBpdGVtLnRhc2tUaW1lDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy50YXNrSXRlbS5wdXNoKHRlbXApOyAvLyBwdXNoIHRoZSBpdGVtIGludG8gdnVlIGRhdGENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gSXRlbSIpDQogICAgICAgICAgICB9DQogICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBjb25zb2xlLmxvZygibm8gdGFzayB5ZXQiKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgIH0pOy8vZW5kIGdldCB0YXNrbGlzdCBpdGVtcw0KDQogICAgICAgICAvL3N0YXJ0IGdldHRpbmcgZnJpZW5kIGxpc3QNCiAgICAgICAgaXRlbXMgPSBnZXREYXRhKHRoaXMudXNlclVpZCwiZnJpZW5kcyIpOw0KICAgICAgICBpdGVtcy50aGVuKChyZXN1bHQpPT57DQogICAgICAgICAgaWYocmVzdWx0ICE9IG51bGwpew0KICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsNCiAgICAgICAgICAgICAgcmVzdWx0ID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQpOw0KICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7DQogICAgICAgICAgICAgIGZvcihsZXQgaXRlbSBvZiByZXN1bHQpew0KICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaXRlbSkNCiAgICAgICAgICAgICAgICBnZXRTZWFyY2hVc2VyKGl0ZW0uZW1haWwpLnRoZW4oKHVzZXIpPT57DQogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gew0KICAgICAgICAgICAgICAgICAgICB1aWQgOiB1c2VyLnVpZCwNCiAgICAgICAgICAgICAgICAgICAgZW1haWwgOiB1c2VyLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA6IHVzZXIudXNlcm5hbWUsDQogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVQaWMgOiB1c2VyLnByb2ZpbGVQaWMNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLm15RnJpZW5kcy5wdXNoKHRlbXApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIEZyaWVuZHMiKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gRnJpZW5kbGlzdCIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7IC8vZW5kIGdldHRpbmcgZnJpZW5kIGxpc3QNCiAgICAgICAgDQogICAgICAgIC8vc3RhcnQgZ2V0dGluZyBmcmllbmQgcmVxdWVzdA0KICAgICAgICBpdGVtcyA9IGdldERhdGEodGhpcy51c2VyVWlkLCJmcmllbmRyZXF1ZXN0Iik7DQogICAgICAgIGl0ZW1zLnRoZW4oKHJlc3VsdCk9PnsNCiAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7DQogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApew0KICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgZm9yKGxldCBpdGVtIG9mIHJlc3VsdCl7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKQ0KICAgICAgICAgICAgICAgIGdldFNlYXJjaFVzZXIoaXRlbS5lbWFpbCkudGhlbigodXNlcik9PnsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB7DQogICAgICAgICAgICAgICAgICAgIHVpZCA6IHVzZXIudWlkLA0KICAgICAgICAgICAgICAgICAgICBlbWFpbCA6IHVzZXIuZW1haWwsDQogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdXNlci51c2VybmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZVBpYyA6IHVzZXIucHJvZmlsZVBpYw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMubXlGcmllbmRSZXF1ZXN0LnB1c2godGVtcCk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBSZXF1ZXN0IikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIHJlcXVlc3QgbGlzdCIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIC8vc3RhcnQgZ2V0dGluZyBhbGwgcG9zdA0KICAgICAgICBpdGVtcyA9IGdldERhdGEoImFsbHBvc3QiLCJwb3N0Iik7DQogICAgICAgIGl0ZW1zLnRoZW4oKHJlc3VsdCk9PnsNCiAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7DQogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApew0KICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgZm9yKGxldCBpdGVtIG9mIHJlc3VsdCl7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKQ0KICAgICAgICAgICAgICAgIHZhciBjb21tZW50ID0gW107DQogICAgICAgICAgICAgICAgaWYoaXRlbS5jb21tZW50cyAhPSBudWxsKXsNCiAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IE9iamVjdC52YWx1ZXMoaXRlbS5jb21tZW50cyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gew0KICAgICAgICAgICAgICAgICAgZG93bmxvYWRVcmwgOiBpdGVtLmRvd25sb2FkVXJsLA0KICAgICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2UgOiBpdGVtLnBvc3RNZXNzYWdlLA0KICAgICAgICAgICAgICAgICAgdWlkIDogaXRlbS51aWQsDQogICAgICAgICAgICAgICAgICBlbWFpbCA6IGl0ZW0uZW1haWwsDQogICAgICAgICAgICAgICAgICB1c2VybmFtZSA6IGl0ZW0udXNlcm5hbWUsDQogICAgICAgICAgICAgICAgICBkYXRlIDogaXRlbS5kYXRlLA0KICAgICAgICAgICAgICAgICAgY29tbWVudHMgOiBjb21tZW50LA0KICAgICAgICAgICAgICAgICAgcHJvZmlsZVBpYzppdGVtLnByb2ZpbGVQaWMNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5hbGxQb3N0LnVuc2hpZnQodGVtcCk7DQoNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBQb3N0IikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIHBvc3QgbGlzdCIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIC8vIC4uLg0KICAgICAgICAvL3JlYWwgdGltZSBsc2l0ZW4gdG8gZnJpZW5kcyBsaXN0DQogICAgICAgIHZhciBkYiA9IGdldEZpcmVzdG9yZSgpOw0KICAgICAgICBvblNuYXBzaG90KGRvYyhkYiwgImZyaWVuZHMiLHVzZXIudWlkKSwoZG9jKT0+ew0KICAgICAgICAgICAgY29uc29sZS5sb2coIkN1cnJlbnQgRGF0YTogIixkb2MuZGF0YSgpKTsNCiAgICAgICAgICAgIGlmKGRvYy5kYXRhKCkpew0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLm15RnJpZW5kcyA9IGRvYy5kYXRhKCkubXlGcmllbmRzOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICAvL3JlYWwgdGltZSBsaXN0ZW4gdG8gZnJpZW5kcmVxdWVzdCANCiAgICAgICAgb25TbmFwc2hvdChkb2MoZGIsICJmcmllbmRyZXF1ZXN0Iix1c2VyLnVpZCksKGRvYyk9PnsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDdXJyZW50IERhdGE6ICIsZG9jLmRhdGEoKSk7DQogICAgICAgICAgICBpZihkb2MuZGF0YSgpKXsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5teUZyaWVuZFJlcXVlc3QgPSBkb2MuZGF0YSgpLnJlcXVlc3Q7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIC8vcmVhbCB0aW1lIGxpc3RlbiB0byBwb3N0DQogICAgICAgIG9uU25hcHNob3QoZG9jKGRiLCAicG9zdCIsImFsbHBvc3QiKSwoZG9jKT0+ew0KICAgICAgICAgICAgY29uc29sZS5sb2coIkN1cnJlbnQgRGF0YTogIixkb2MuZGF0YSgpKTsNCiAgICAgICAgICAgIGlmKGRvYy5kYXRhKCkuYWxsUG9zdEl0ZW1zLmxlbmd0aCAhPTApew0KICAgICAgICAgICAgICAgIGlmKHRoaXMuYWxsUG9zdC5sZW5ndGggIT0gZG9jLmRhdGEoKS5hbGxQb3N0SXRlbXMubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gZG9jLmRhdGEoKS5hbGxQb3N0SXRlbXMucG9wKCkNCiAgICAgICAgICAgICAgICAgIHRoaXMuYWxsUG9zdC51bnNoaWZ0KHRlbXApOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgdGhpcy5hbGxQb3N0ID0gZG9jLmRhdGEoKS5hbGxQb3N0SXRlbXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9ZWxzZXsNCiAgICAgIGNvbnNvbGUubG9nKCJObyB1c2VyIik7DQogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0iL2xvZ2luIjsNCiAgICB9DQogICAgfSk7DQogIH0sDQp9DQphc3luYyBmdW5jdGlvbiBnZXRTZWFyY2hVc2VyKGVtYWlsKXsNCiAgICB2YXIgZGIgPSBnZXRGaXJlc3RvcmUoKTsNCiAgICB2YXIgdXNlcg0KICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbGxlY3Rpb24oZGIsICJ1c2VycyIpKTsNCiAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4gew0KICAgIC8vY29uc29sZS5sb2coYCR7ZG9jLmlkfSA9PiAke2RvYy5kYXRhKCkuZW1haWx9YCk7DQogICAgaWYoZG9jLmRhdGEoKS5lbWFpbCA9PSBlbWFpbCl7DQogICAgICAvL2NvbnNvbGUubG9nKGRvYy5pZCk7DQogICAgICB1c2VyID0gew0KICAgICAgICB1aWQgOiBkb2MuaWQsDQogICAgICAgIGVtYWlsIDogZG9jLmRhdGEoKS5lbWFpbCwNCiAgICAgICAgdXNlcm5hbWUgOiBkb2MuZGF0YSgpLnVzZXJuYW1lLA0KICAgICAgICBwcm9maWxlUGljIDogZG9jLmRhdGEoKS5wcm9maWxlUGljDQogICAgICB9DQogICAgICAvL2NvbnNvbGUubG9nKHRlbXApOw0KICAgICAgDQogICAgfQ0KfSk7DQogICAgcmV0dXJuIHVzZXI7DQp9DQphc3luYyBmdW5jdGlvbiAgZ2V0RGF0YSh1aWQsc291cmNlKXsNCiAgICAvL2dldCBhbGwgdGFzayB0aGF0IGEgdWlkIGhhdmUgYW5kIHJldHVybiBhbiBhcnJheSBvZiB0YXNraXRlbSBvYmplY3RzDQogICAgLy9pZiB1c2VyIHlldCB0byBoYXZlIGFueSB0YXNrLCBudWxsIHdpbGwgYmUgcmV0dXJuZWQgDQogICAgdmFyIGRiID0gZ2V0RmlyZXN0b3JlKCk7DQogICAgdmFyIHJlc3VsdCA9IG51bGw7DQogICAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgc291cmNlKSk7DQogICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHsNCiAgICAvL2NvbnNvbGUubG9nKGRvYy5kYXRhKCkpOw0KICAgIGlmKGRvYy5pZCA9PSB1aWQpew0KICAgICAgICByZXN1bHQgPSBkb2MuZGF0YSgpOw0KICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpOw0KICAgIH0NCg0KICAgIH0pOw0KICAgIGlmKHJlc3VsdCAhPSBudWxsICYmIE9iamVjdC52YWx1ZXMocmVzdWx0KS5sZW5ndGggIT0gMCl7DQogICAgICBpZihzb3VyY2UgPT0gInRhc2tsaXN0Iil7DQogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdC50YXNrSXRlbSk7DQogICAgICB9ZWxzZSBpZihzb3VyY2UgPT0gImZyaWVuZHMiKXsNCiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KyJJbWhlcmUhIikNCiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocmVzdWx0Lm15RnJpZW5kcyk7DQogICAgICB9ZWxzZSBpZihzb3VyY2UgPT0gImZyaWVuZHJlcXVlc3QiKXsNCiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocmVzdWx0LnJlcXVlc3QpOw0KICAgICAgfWVsc2UgaWYoc291cmNlID09ICJwb3N0Iil7DQogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdC5hbGxQb3N0SXRlbXMpOw0KICAgICAgfQ0KICAgIA0KICAgIH0NCiAgICBlbHNlew0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogIA0KfQ0KYXN5bmMgZnVuY3Rpb24gdXBkYXRlRGJUYXNrSXRlbSh1aWQsaXRlbXMpew0KICAgIC8vdXNlciB0byB1cGRhdGUgdGhlIFRhc2sgaXRlbXMgdG8gdGhlIHVpZCBnaXZlbg0KICAgIHZhciBkYiA9IGdldEZpcmVzdG9yZSgpOw0KICAgIGNvbnNvbGUubG9nKGl0ZW1zKQ0KICAgIGF3YWl0IHNldERvYyhkb2MoZGIsInRhc2tsaXN0Iix1aWQpLHsNCiAgICAgIHRhc2tJdGVtIDogaXRlbXMNCiAgICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZURiRnJpZW5kcyh1aWQsaXRlbXMpew0KICAgIC8vdXBkYXRlIHVzZXIncyBmcmllbmQgbGlzdA0KICAgIHZhciBkYiA9IGdldEZpcmVzdG9yZSgpOw0KICAgIGNvbnNvbGUubG9nKGl0ZW1zKQ0KICAgIGF3YWl0IHNldERvYyhkb2MoZGIsImZyaWVuZHMiLHVpZCksew0KICAgICAgbXlGcmllbmRzIDogaXRlbXMNCiAgICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHNlbmREYkZyaWVuZFJlcXVlc3QodXBkYXRlZFJlcXVlc3QsZnJpZW5kKXsNCiAgICB2YXIgZGIgPSBnZXRGaXJlc3RvcmUoKTsNCiAgICBjb25zb2xlLmxvZyhmcmllbmQpOw0KICAgIGF3YWl0IHNldERvYyhkb2MoZGIsImZyaWVuZHJlcXVlc3QiLGZyaWVuZC51aWQpLHsNCiAgICAgIHJlcXVlc3QgOiB1cGRhdGVkUmVxdWVzdA0KICAgIH0pOw0KfQ0KYXN5bmMgZnVuY3Rpb24gdXBkYXRlRGJQb3N0KHBvc3Qpew0KICAgIHZhciBkYiA9IGdldEZpcmVzdG9yZSgpOw0KICAgIGNvbnNvbGUubG9nKHBvc3QpDQogICAgYXdhaXQgc2V0RG9jKGRvYyhkYiwicG9zdCIsImFsbHBvc3QiKSx7DQogICAgICBhbGxQb3N0SXRlbXMgOiBwb3N0DQogICAgfSk7DQogICAgDQp9DQo="},{"version":3,"sources":["Community.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"Community.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n<div id=app class=\"container-fluid\">\r\n          <div class=\"row my-3\">\r\n              <!--api messages-->\r\n              <div class=\"col-12 bg-light\">API Content</div>\r\n\r\n          </div>\r\n          \r\n          <div class=\"row text-center justify-content-md-center\">\r\n              <!--To do list-->\r\n              <div id=\"taskList\" class=\"col-xl-3 col-lg-3 order-lg-1 col-md-5 order-md-1\">\r\n                <div class=\"my-3\">\r\n                    <button class=\"button my-3\" @click=\"showModal = true\">New Task</button>\r\n                    <transition name=\"fade\" appear>\r\n                      <div class=\"modal-overlay\" v-if=\"showModal\" >\r\n                        <div class=\"popUp\">\r\n                            <h3>Add a New Task</h3>\r\n                            <hr>\r\n                            <div class=\"mb-4\">\r\n                              <label for=\"exampleFormControlInput1\" class=\"form-label\">Description</label>\r\n                              <input type=\"text\" id=\"\" class=\"form-control\" placeholder=\"Task Description\" v-model=\"newTaskItem.newTaskDesc\">\r\n                            </div>\r\n                            <div class=\"mb-4\">\r\n                              <label for=\"exampleFormControlInput1\" class=\"form-label\">Due Date</label>\r\n                              <input type=\"date\" id=\"\" class=\"form-control\" v-model=\"newTaskItem.newTaskDueDate\">\r\n                            </div>\r\n                            <div class=\"mb-4\">\r\n                              <label for=\"exampleFormControlInput1\" class=\"form-label\">Time (Optional)</label>\r\n                              <input type=\"time\" id=\"\" class=\"form-control\" v-model=\"newTaskItem.newTaskDueTime\">\r\n                            </div>\r\n                            <p v-if=\"newTaskError\" class=\"text-danger\">The please provide the task description and the duedate !</p>\r\n                            <hr>\r\n                            <button class=\"button mx-3\" @click=\"showModal = false; newTaskError =false\">Close</button>\r\n                            <button v-if=\"newTaskItem.newTaskDueDate != ''\" class=\"button mx-3\" @click=\"addNewTask\">Add Task</button>\r\n                            <button v-else class=\"button mx-3\" @click=\"showNewTaskError\">Add Task</button>\r\n                        </div>     \r\n                      </div>\r\n                    </transition>\r\n                </div>\r\n                <h3 class=\"text-light\">Your Task List</h3>\r\n                <hr class=\"border border-light\">\r\n                <div v-for=\"(task,key) in taskItem\" v-bind:key=\"task.taskId\" >\r\n                    <div id =\"tasks\" class=\"card mx-auto\" style=\"max-width: 75%;\">\r\n                        <div class=\"card-body text-secondary\">\r\n                          <p class=\"card-text\" >{{task.taskDesc}}</p>\r\n                          <p class=\"card-text\" >{{task.taskDue}}</p>\r\n                          <p v-if=\"task.taskTime != ''\">{{task.taskTime}}</p>\r\n                          <button type=\"button\" class=\"btn btn-success\" @click=\"removeTask(key)\">Completed</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                  \r\n              </div>\r\n\r\n              <!--Community Post-->\r\n              <div class=\"col-xl-6 col-lg-5 order-lg-2 col-md-6 order-md-3\">\r\n                <h1 class=\"text-light\">SCIS Reddit Community</h1>\r\n                <div class=\"bg-white p-3 rounded-3 bg-opacity-75\">\r\n                  <div class=\"form-group text-start mt-3\">\r\n                    <label for=\"exampleInputEmail1\">Share your thoughts</label>\r\n                    <textarea type=\"text\" class=\"form-control mt-1\" v-model=\"postMessage\" placeholder=\"Type here...\"></textarea>\r\n                    <img class=\"my-2\" style=\"dispay:none\" id=\"myimg\" src=\"\" alt=\"\">\r\n\r\n                    <button type=\"button\" class=\"btn btn-secondary mt-2\" @click=\"selectImg\">Upload Photo</button>\r\n                    <button v-if=\"photoPath\" type=\"button\" class=\"btn btn-secondary mx-2 mt-2\" @click=\"removePhoto\">Remove Photo</button>\r\n                    <input type=\"file\" id=\"hiddenSelectImg\" style=\"display:none\">\r\n                    <br>\r\n                    <small>Note: Photo file size must be smaller than 2mb !!!</small>\r\n                  </div>\r\n                  <hr>\r\n                  <p v-if=\"noPublishContent\"><small class=\"text-danger\">Please share your thoughts...</small></p>\r\n                  <button v-if=\"postMessage.trim()==''\" class=\"button \" @click=\"noPublishContent = true\">Publish</button>\r\n                  <button v-else class=\"button \" @click=\"publishPost();noPublishContent =false\">Publish</button>\r\n                 \r\n                </div>\r\n                \r\n                <div v-if=\"allPost != []\" class=\"card mb-3 rounded-5\">\r\n                  <div v-for=\"(post,key) in allPost\" v-bind:key=\"key\" class=\"bg-white p-3 rounded-3 my-2 bg-opacity-75\">\r\n                    <div class=\"card-body text-start\">\r\n                      <h5 v-if=\"post.email != user.email\" class=\"card-title\">\r\n                      <img :src=\"post.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">{{post.username}}</h5>\r\n                      <h5 v-else class=\"card-title\"><img :src=\"user.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">My post</h5>\r\n                      <img v-if=\"post.downloadUrl != ''\" :src=\"post.downloadUrl\" class=\"card-img-top mb-3\" alt=\"...\">\r\n                      <p class=\"card-text\">{{post.postMessage}}</p>\r\n                      <p class=\"card-text\"><small class=\"text-muted\">Published on: {{post.date.toString()}}</small></p>\r\n                      <ul v-for=\"(comment,ckey) in post.comments\"  v-bind:key=\"ckey\" class=\"list-group\">\r\n                        <li class=\"list-group-item\">{{comment}}</li>\r\n                      </ul>   \r\n                    </div>\r\n                    <div class=\"input-group mb-3\">\r\n                      <input type=\"text\" class=\"form-control\" placeholder=\"Your Comment...\" v-model=\"newComment\">\r\n                      <div class=\"input-group-append\">\r\n                        <button v-if=\"newComment.trim() != ''\" class=\"btn btn-outline-secondary\" type=\"button\" @click=\"processComment(key)\">Comment</button>\r\n                        <button v-else class=\"btn btn-outline-secondary\" type=\"button\" disabled>Comment</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <!--Friend List-->\r\n              <div id=\"friendlisthide\" class=\"col-xl-3 col-lg-4 order-lg-3 col-md-5 order-md-2\">\r\n              <div class=\"container d-flex justify-content-center align-items-center\">\r\n                  <div class=\"card bg-white bg-opacity-75 px-5 py-2 mx-2 w-100\">\r\n                      <div class=\"text-center\">\r\n                          <h4 v-if=\"user != null\" class=\"my-1\">\r\n                            <img :src=\"user.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\"> {{user.username}}</h4>\r\n                          <button class=\"button p-2\" @click=\"showProfile=true\">Profile</button>\r\n                          <div class=\"justify-content-between align-items-center mt-4 px-4 w-100\">\r\n                              <div>\r\n                                  <h6>Tasks: {{taskItem.length}}</h6>\r\n                                  <h6>Friends: {{myFriends.length}} Request: {{myFriendRequest.length}}</h6>\r\n                              </div>\r\n                        </div>\r\n                        <transition name=\"fade\" appear>\r\n                              <div class=\"modal-overlay\" v-if=\"showProfile\" >\r\n                                <div class=\"popUp\">\r\n                                  <div class=\"card-header\">\r\n                                    Profile\r\n                                  </div>\r\n                                  <div v-if=\"edit == false\" class=\"card-body\">\r\n                                       <h5 class=\"card-title\">{{user.email}}</h5>\r\n                                      <p class=\"card-text\">{{user.username}}</p>\r\n                                  </div>\r\n                                  <div v-else class=\"card-body\">\r\n                                       <h5 class=\"card-title\">{{user.email}}</h5>\r\n                                       <hr>\r\n                                       Username :\r\n                                      <input class=\"card-text mb-2\" v-model=\"newUsername\"><br>\r\n                                      <span v-if=\"newUsernameError\" class=\"text-danger\">Invalid username</span>\r\n                                      <p>Profile Picture</p>\r\n                                      <img v-for=\"(url,key) in photoLink\" v-bind:key=\"key\" :src=\"url\" class=\"editProfile rounded-circle mx-1 mt-0\" alt=\"Chris Wood\" width=\"40\" height=\"40\"\r\n                                      @click=\"selectedImg = url\"><br>\r\n                                      <div v-if=\"selectedImg != ''\">\r\n                                        <h5>New Profile Picture</h5><img :src=\"selectedImg\" class=\"rounded-circle my-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">\r\n                                      </div>\r\n                                      <button type=\"button\" class=\"btn btn-primary\" @click=\"updateUsername\">Update</button>\r\n                                      <hr>\r\n                                      Change Password (Optional)\r\n                                      <br>\r\n                                      <input class=\"my-2\" type=\"password\" v-model=\"oldPw\" placeholder=\"Old Password\">\r\n                                      <input class=\"mb-2\" type=\"password\" v-model=\"newPw\" placeholder=\"New Password\"><br>\r\n                                      <span v-if=\"updatePasswordError\" class=\"text-danger\">Wrong Password</span><br>\r\n                                      <button type=\"button\" class=\"btn btn-primary\" @click=\"changePassword\">Change Password</button>\r\n                                  </div>\r\n                                  \r\n                                  <hr>\r\n                                  <button class=\"button px-4 mx-4\" @click=\"edit=true\">Edit</button>\r\n                                  <button class=\"button px-4 mx-4\" @click=\"showProfile=false;newUsernameError=false;updatePasswordError=false\">Close</button>\r\n                                </div>     \r\n                              </div>\r\n                        </transition>\r\n                      </div>\r\n                  </div>\r\n              </div>\r\n                <h3 class=\"text-light fw-bold\">Friends</h3>\r\n                <hr class=\"border border-light\">\r\n                <ul v-if=\"myFriends.length !=0\" class=\"list-group\">\r\n                    <li v-for=\"(friend,key) in myFriends\" class=\"list-group-item list-group-item-info text-start\" id=\"listfriend\" v-bind:key=\"key\" @click=\"showFriendInfo=true;getFriendInfo(friend)\">\r\n                      <img :src=\"friend.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">\r\n                        {{friend.username}}</li>\r\n                </ul>\r\n                <p v-else class=\"text-light\">Add your first friend!</p>\r\n                 <transition name=\"fade\" appear>\r\n                      <div class=\"modal-overlay\" v-if=\"showFriendInfo\" >\r\n                        <div class=\"popUp\">\r\n                          <div class=\"card-header\">\r\n                            Friend Info\r\n                          </div>\r\n                          <div class=\"card-body\">\r\n                            <h5 class=\"card-title\">{{friendInfo.username}}</h5>\r\n                            <p class=\"card-text\">{{friendInfo.email}}</p>\r\n                            <button type=\"button\" class=\"btn btn-primary m-1\" @click=\"toMessage\">Message</button>\r\n                            <button type=\"button\" class=\"btn btn-outline-danger m-1\" @click=\"deleteFriend(friendInfo);friendInfo=null;showFriendInfo=false\" >Delete</button>\r\n                          </div>\r\n                          \r\n                          <hr >\r\n                            <button class=\"button mx-3\" @click=\"showFriendInfo = false;\">Close</button>\r\n                        </div>     \r\n                      </div>\r\n                </transition>\r\n                <hr class=\"border border-light\">\r\n                <p class=\"text-light fw-bold\">Friend Request</p>\r\n                <ul v-if=\"myFriendRequest.length != 0\" class=\"list-group\">\r\n                    <li v-for=\"(request,key) in myFriendRequest\" class=\"list-group-item list-group-item-info\" v-bind:key=\"key\">{{request.username}}\r\n                      <br>\r\n                      <button type=\"button\" class=\"btn btn-outline-danger m-1\" @click=\"processFriendRequest(request,key,false)\">Reject</button>\r\n                      <button type=\"button\" class=\"btn btn-outline-success m-1\" @click=\"processFriendRequest(request,key,true)\">Accept</button>\r\n                    </li>\r\n                </ul>\r\n                <p v-else class=\"text-light\">No request...</p>\r\n                <hr class=\"border border-light\">\r\n                <button class=\"button my-3\" @click=\"showSearchFriend=true\">New Friend</button>\r\n                <transition name=\"fade\" appear>\r\n                      <div class=\"modal-overlay\" v-if=\"showSearchFriend\" >\r\n                        <div class=\"popUp\">\r\n                            <h3 class=\"text-dark\">Search for a Friend</h3>\r\n                            <hr>\r\n                            <div class=\"input-group mb-3\">\r\n                              <input type=\"text\" class=\"form-control\" placeholder=\"Enter an email\" v-model=\"searchEmail\">\r\n                              <button class=\"btn btn-outline-secondary\" type=\"button\" id=\"button-addon2\" @click=\"findUser\">Search</button>\r\n                            </div>\r\n                            \r\n                            <div v-if=\"searchUser != null && searchUser !=false\" class=\"card\">\r\n                              <hr>\r\n                                <div class=\"card-header\">\r\n                                  Result\r\n                                </div>\r\n                                <div class=\"card-body\">\r\n                                  <h5 class=\"card-title\">{{searchUser.username}}</h5>\r\n                                  <p class=\"card-text\">{{searchUser.email}}</p>\r\n                                  <button v-if=\"searchUser.email == user.email\" class=\"button mx-3\" disabled>Yourself</button>\r\n                                  <button v-else-if=\"(myFriends.filter((item,key)=>item.email == searchUser.email)).length != 0\" class=\"btn btn-outline-danger m-3\" @click=\"deleteFriend(searchUser)\">Delete Friend</button>\r\n                                  <button v-else class=\"button mx-3\" @click=\"sendFriendRequest\">Add Friend</button>\r\n                                </div>\r\n                            </div>\r\n                            <p v-if=\"searchUser ==false\">No such user...</p>\r\n                            <hr>\r\n                            <button class=\"button mx-3\" @click=\"showSearchFriend = false; searchUser=null; searchEmail=''\">Close</button>\r\n                        </div>     \r\n                      </div>\r\n                </transition>\r\n              </div>\r\n          </div>\r\n      </div>\r\n</template>\r\n<script>\r\n// <template>\r\n//   <div id=\"app\">\r\n//     <div id=\"nav\">\r\n//       <router-link to=\"/\">Home</router-link> |\r\n//       <router-link to=\"/about\">About</router-link>\r\n//     </div>\r\n//     <router-view/>\r\n//   </div>\r\n// </template>\r\n//<HelloWorld msg=\"Welcome to Your Vue.js App\"/>\r\n//import HelloWorld from './components/HelloWorld.vue'\r\nimport { getAuth , onAuthStateChanged, signInWithEmailAndPassword,updatePassword} from \"firebase/auth\";\r\nimport { getDocs ,getFirestore ,collection, setDoc ,doc,onSnapshot} from \"firebase/firestore\"; \r\nimport {getStorage , ref, uploadBytes, getDownloadURL} from \"firebase/storage\";\r\nexport default {\r\n  name: 'app',\r\n  data(){\r\n    return {\r\n      taskItem:[\r\n          // {\r\n          //   taskId : 1,\r\n          //   taskDesc: \"This is task 1\",\r\n          //   taskDue: \"11/8/2021\",\r\n          //   taskTime: \"\"\r\n          // },\r\n          // {\r\n          //   taskId : 2,\r\n          //   taskDesc: \"This is task 2\",\r\n          //   taskDue: \"11/8/2021\",\r\n          //   taskTime: \"\"\r\n          // }\r\n      ],\r\n      newTaskItem:{\r\n\r\n        newTaskDesc : \"\",\r\n        newTaskDueDate : \"\",\r\n        newTaskDueTime : \"\",\r\n        \r\n      },\r\n      //modals \r\n      showModal : false, //for new task\r\n      showSearchFriend : false,\r\n      showFriendInfo: false,\r\n      showProfile :false,\r\n\r\n      //search\r\n      searchEmail : \"\",\r\n      searchUser : null,\r\n\r\n      //errors\r\n      newTaskError: false,\r\n\r\n      //friends\r\n      myFriends: [],\r\n      myFriendRequest :[],\r\n      friendInfo : null,\r\n      photoLink : [\r\n      \"https://bootdey.com/img/Content/avatar/avatar1.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar2.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar3.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar4.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar5.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar6.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar7.png\",\r\n      \"https://bootdey.com/img/Content/avatar/avatar8.png\"\r\n      ],\r\n      //currentUser\r\n      user : null,\r\n\r\n      //community post\r\n      photoPath : null,\r\n      postMessage : \"\",\r\n      allPost : [],\r\n      myPost: 0,\r\n      pictUrl : \"\",\r\n      noPublishContent: false,\r\n      //Comment\r\n      newComment : \"\",\r\n\r\n      //changePassword\r\n      edit : false,\r\n      saveBtn : false,\r\n      oldPw : \"\",\r\n      newPw : \"\",\r\n      newUsername : \"\",\r\n      newUsernameError : false,\r\n      updatePasswordError : false,\r\n      selectedImg : \"\"\r\n    }\r\n  },\r\n  components: {\r\n    //HelloWorld,\r\n  },\r\n  methods:{\r\n    addNewTask(){\r\n      console.log(this.newTaskItem)\r\n      var item = {\r\n            //taskId : this.taskItem.length + 1,\r\n            taskDesc: this.newTaskItem.newTaskDesc,\r\n            taskDue: this.newTaskItem.newTaskDueDate,\r\n            taskTime: this.newTaskItem.newTaskDueTime\r\n      }\r\n\r\n      this.taskItem.push(item)\r\n      this.showModal = false;\r\n\r\n      //update the database\r\n      var updatedItem = Object.assign({}, this.taskItem);\r\n      //console.log(updatedItem);\r\n      var promise = updateDbTaskItem(this.userUid,updatedItem);\r\n      promise.then(()=>{\r\n        console.log(\"Success\");\r\n        this.newTaskItem.newTaskDesc = \"\";\r\n        this.newTaskItem.newTaskDueDate = \"\";\r\n        this.newTaskItem.newTaskDueTime = \"\";\r\n        this.newTaskError = false;\r\n      })\r\n      \r\n    },\r\n    removeTask(id){\r\n      this.taskItem = this.taskItem.filter((item,key)=>key != id);\r\n            //update the database\r\n      var updatedItem = Object.assign({}, this.taskItem);\r\n      //console.log(updatedItem);\r\n      var promise = updateDbTaskItem(this.userUid,updatedItem);\r\n      promise.then(()=>{\r\n        console.log(\"Success\");\r\n        this.newTaskItem.newTaskDesc = \"\";\r\n        this.newTaskItem.newTaskDueDate = \"\";\r\n        this.newTaskItem.newTaskDueTime = \"\";\r\n        this.newTaskError = false;\r\n      })\r\n    },\r\n    showNewTaskError(){\r\n      this.newTaskError = true;\r\n    },\r\n    findUser(){\r\n      console.log(this.searchEmail);\r\n      var userInfo = getSearchUser(this.searchEmail);\r\n      userInfo.then((user)=>{\r\n        if(user){\r\n          this.searchUser = user;\r\n        }else{\r\n          this.searchUser = false;\r\n        }\r\n        \r\n      });\r\n    },\r\n    sendFriendRequest(){\r\n      // console.log(this.searchUser);\r\n      // console.log(this.user)\r\n      var updatedRequest = [];\r\n      var allRequest = getData(this.searchUser.uid,\"friendrequest\");\r\n        allRequest.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                var temp = {\r\n                  uid : item.uid,\r\n                  email : item.email,\r\n                  username : item.username\r\n                }\r\n                updatedRequest.push(temp);\r\n              }\r\n              updatedRequest.push(this.user);\r\n            }else{\r\n              updatedRequest.push(this.user);\r\n              console.log(\"No request\")\r\n            } \r\n          }else{\r\n            updatedRequest.push(this.user);\r\n            console.log(\"No request list\");\r\n          }\r\n          var response = sendDbFriendRequest(updatedRequest,this.searchUser);\r\n          response.then(()=>{\r\n              console.log(\"friend request send\");\r\n          });\r\n        }); \r\n\r\n    },\r\n    processFriendRequest(friend,id,action){\r\n      //action true -> accept\r\n      //action false -> reject\r\n      this.myFriendRequest = this.myFriendRequest.filter((request,key)=>key != id);\r\n\r\n      //update the database\r\n      //var updateRequest = Object.assign({},this.myFriendRequest);\r\n      var promise = sendDbFriendRequest(this.myFriendRequest,this.user);\r\n      promise.then(()=>{\r\n        if(action == true){\r\n          console.log(\"Friend Request accepted !\");\r\n          this.myFriends.push(friend);\r\n\r\n          //update database friend list for current user\r\n          var items = updateDbFriends(this.user.uid,this.myFriends);\r\n          items.then(()=>{\r\n            console.log(\"Friend list updated!\");\r\n          });\r\n          //update database friend list for friend\r\n          var updatedFriendListItems =[];\r\n          var friendListItems = getData(friend.uid,\"friends\");\r\n          friendListItems.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                var temp = {\r\n                  uid : item.uid,\r\n                  email : item.email,\r\n                  username : item.username,\r\n                  profilePic : item.profilePic\r\n                }\r\n                updatedFriendListItems.push(temp);\r\n              }\r\n              updatedFriendListItems.push(this.user)\r\n            }else{\r\n              updatedFriendListItems.push(this.user)\r\n              console.log(\"No Friends\")\r\n            }\r\n            \r\n          }else{\r\n            updatedFriendListItems.push(this.user)\r\n            console.log(\"No Friendlist\");\r\n          }\r\n          items = updateDbFriends(friend.uid,updatedFriendListItems);\r\n          items.then(()=>{\r\n            console.log(\"Friend list updated!\");\r\n          });\r\n        }); \r\n\r\n        }else{\r\n          console.log(\"Friend Request rejected !\");\r\n        }\r\n      });\r\n    },\r\n    deleteFriend(unfriend){\r\n      this.myFriends = this.myFriends.filter((friend)=>friend.email != unfriend.email);\r\n\r\n      //delete for current user\r\n      var promise = updateDbFriends(this.user.uid,this.myFriends);\r\n      promise.then(()=>{\r\n        console.log(\"Friend list updated!\");\r\n\r\n          //get target unfriend\r\n          var updatedFriendListItems =[];\r\n          var friendListItems = getData(unfriend.uid,\"friends\");\r\n          friendListItems.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                if(item.email != this.user.email){\r\n                  var temp = {\r\n                    uid : item.uid,\r\n                    email : item.email,\r\n                    username : item.username\r\n                  }\r\n                  updatedFriendListItems.push(temp);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          var items = updateDbFriends(unfriend.uid,updatedFriendListItems);\r\n          items.then(()=>{\r\n            console.log(\"Friend list updated!\");\r\n          });\r\n        });\r\n      });\r\n    },\r\n    getFriendInfo(friend){\r\n        this.friendInfo = friend;\r\n    },\r\n    selectImg(){\r\n      // var ImgName, ImgUrl;\r\n    \r\n      // var reader = new FileReader();\r\n      var input = document.getElementById(\"hiddenSelectImg\");\r\n      \r\n      input.onchange = e =>{\r\n        var files = e.target.files;\r\n        var reader = new FileReader();\r\n        reader.onload = function(){\r\n          document.getElementById(\"myimg\").src = reader.result;\r\n          document.getElementById(\"myimg\").style = \"display:block;height:100px;width:100px; border:1px solid black\";\r\n        }\r\n        //console.log(files[0].name);\r\n        this.photoPath = files[0];\r\n        reader.readAsDataURL(files[0]);\r\n      }\r\n      input.click();\r\n    },\r\n    publishPost(){\r\n\r\n      var downloadUrl = \"\";\r\n      var storage = getStorage();\r\n      if(this.photoPath != null){\r\n        \r\n        downloadUrl = \"images/\"+this.photoPath.name;\r\n        var photoRef = ref(storage,downloadUrl);\r\n        \r\n        uploadBytes(photoRef,this.photoPath).then((snapshot)=>{\r\n          console.log(snapshot);\r\n        });\r\n\r\n      }\r\n      var getUrl = getDownloadURL(ref(storage,downloadUrl));\r\n      getUrl.then((url)=>{\r\n          var newPost = {\r\n          downloadUrl : url,\r\n          postMessage : this.postMessage,\r\n          uid : this.user.uid,\r\n          email : this.user.email,\r\n          username : this.user.username,\r\n          date : new Date().toDateString(),\r\n          comments : [],\r\n          profilePic : this.user.profilePic\r\n        }\r\n        this.processPublish(newPost);\r\n      }).catch(()=>{\r\n          var newPost = {\r\n          downloadUrl : \"\",\r\n          postMessage : this.postMessage,\r\n          uid : this.user.uid,\r\n          email : this.user.email,\r\n          username : this.user.username,\r\n          date : new Date().toDateString(),\r\n          comments : [],\r\n          profilePic : this.user.profilePic\r\n        }\r\n        this.processPublish(newPost);\r\n      });     \r\n    },\r\n    removePhoto(){\r\n      this.photoPath = null;\r\n      this.pictUrl = \"\";\r\n      document.getElementById(\"myimg\").src = \"\";\r\n      document.getElementById(\"myimg\").style = \"display:none;\";\r\n    },\r\n    processPublish(newPost){\r\n      var updatePost = []\r\n      var items = getData(\"allpost\",\"post\");\r\n      items.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                var temp = {\r\n                  downloadUrl : item.downloadUrl,\r\n                  postMessage : item.postMessage,\r\n                  uid : item.uid,\r\n                  email : item.email,\r\n                  username : item.username,\r\n                  date : item.date,\r\n                  profilePic : item.profilePic\r\n                }\r\n                updatePost.push(temp);\r\n              }\r\n            }else{\r\n              console.log(\"No Friends\")\r\n            }\r\n            \r\n          }else{\r\n            console.log(\"No Friendlist\");\r\n          }\r\n          updatePost.push(newPost);\r\n          var promise = updateDbPost(updatePost);\r\n          promise.then(()=>{\r\n            console.log(\"Post Updated\");\r\n          })\r\n      }); \r\n      this.photoPath = null;\r\n      this.postMessage  = \"\";\r\n      this.pictUrl = \"\";\r\n      //this.allPost.unshift(newPost);\r\n      document.getElementById(\"myimg\").src = \"\";\r\n      document.getElementById(\"myimg\").style = \"display:none;\";\r\n    },\r\n    processComment(key){\r\n      this.allPost[key].comments.push(this.newComment);\r\n      var temp = this.allPost;\r\n      updateDbPost(temp).then(()=>{\r\n        console.log(\"Comment updated\");\r\n      });\r\n      this.newComment = \"\";\r\n    },\r\n    updateUsername(){\r\n      this.newUsernameError = false;\r\n      var db = getFirestore();\r\n      var userRef = doc(db,\"users\",this.user.uid);\r\n\r\n      if(this.newUsername.trim()==\"\"){\r\n        if(this.selectedImg != \"\"){\r\n            setDoc(userRef,{profilePic:this.selectedImg},{merge:true}).then(()=>{\r\n            console.log(\"Username updated\");\r\n            this.user.profilePic = this.selectedImg;\r\n            this.selectedImg = \"\";\r\n            this.showProfile = false;\r\n          });\r\n          return;\r\n        }\r\n        this.newUsernameError = true;\r\n        return;\r\n      }\r\n\r\n\r\n        setDoc(userRef,{username:this.newUsername},{merge:true}).then(()=>{\r\n        console.log(\"Username updated\");\r\n        this.user.username = this.newUsername;\r\n        this.newUsername = \"\";\r\n        this.showProfile = false;\r\n      });\r\n\r\n    },\r\n    changePassword(){\r\n      var auth = getAuth();\r\n      signInWithEmailAndPassword(auth,this.user.email,this.oldPw).then(()=>{\r\n          //correct password\r\n          var user = auth.currentUser;\r\n          updatePassword(user,this.newPw).then(()=>{\r\n            console.log(\"Password updated\");\r\n            this.newPw = \"\";\r\n            this.oldPw = \"\";\r\n          });\r\n      }).catch(()=>{\r\n          this.updatePasswordError = true;\r\n          this.newPw = \"\";\r\n          this.oldPw = \"\";\r\n      })\r\n    },\r\n    toMessage(){\r\n        window.location.href = \"/Messages\";\r\n    },\r\n\r\n  },\r\n  beforeCreate(){\r\n    const auth = getAuth();\r\n    onAuthStateChanged(auth, (user) => {\r\n    if (user) {\r\n        // User is signed in, see docs for a list of available properties\r\n        // https://firebase.google.com/docs/reference/js/firebase.User\r\n        console.log(user.email);\r\n        var userInfo = getSearchUser(user.email);\r\n        userInfo.then((user)=>{\r\n          this.user=user;\r\n        });\r\n        this.userUid = user.uid; //log the uid in vue\r\n\r\n        //Start getting tasklist\r\n        var items = getData(this.userUid,\"tasklist\"); \r\n        items.then((result)=>{ //handles the promise\r\n          //console.log(result);\r\n          if(result != null){\r\n            if(result.length !=0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n              //console.log(item);\r\n              var temp = {\r\n                taskDesc: item.taskDesc,\r\n                taskDue: item.taskDue,\r\n                taskTime: item.taskTime\r\n              }\r\n              this.taskItem.push(temp); // push the item into vue data\r\n            }\r\n            }else{\r\n              console.log(\"No Item\")\r\n            }\r\n          }else{\r\n            console.log(\"no task yet\");\r\n          }\r\n\r\n         });//end get tasklist items\r\n\r\n         //start getting friend list\r\n        items = getData(this.userUid,\"friends\");\r\n        items.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                getSearchUser(item.email).then((user)=>{\r\n                    var temp = {\r\n                    uid : user.uid,\r\n                    email : user.email,\r\n                    username : user.username,\r\n                    profilePic : user.profilePic\r\n                    }\r\n                    this.myFriends.push(temp);\r\n                });\r\n              }\r\n            }else{\r\n              console.log(\"No Friends\")\r\n            }\r\n            \r\n          }else{\r\n            console.log(\"No Friendlist\");\r\n          }\r\n        }); //end getting friend list\r\n        \r\n        //start getting friend request\r\n        items = getData(this.userUid,\"friendrequest\");\r\n        items.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                getSearchUser(item.email).then((user)=>{\r\n                    var temp = {\r\n                    uid : user.uid,\r\n                    email : user.email,\r\n                    username : user.username,\r\n                    profilePic : user.profilePic\r\n                    }\r\n                    this.myFriendRequest.push(temp);\r\n                });\r\n\r\n              }\r\n            }else{\r\n              console.log(\"No Request\")\r\n            }\r\n            \r\n          }else{\r\n            console.log(\"No request list\");\r\n          }\r\n        });\r\n        //start getting all post\r\n        items = getData(\"allpost\",\"post\");\r\n        items.then((result)=>{\r\n          if(result != null){\r\n            if(result.length != 0){\r\n              result = Object.values(result);\r\n              //console.log(result);\r\n              for(let item of result){\r\n                //console.log(item)\r\n                var comment = [];\r\n                if(item.comments != null){\r\n                    comment = Object.values(item.comments);\r\n                }\r\n                var temp = {\r\n                  downloadUrl : item.downloadUrl,\r\n                  postMessage : item.postMessage,\r\n                  uid : item.uid,\r\n                  email : item.email,\r\n                  username : item.username,\r\n                  date : item.date,\r\n                  comments : comment,\r\n                  profilePic:item.profilePic\r\n                }\r\n                this.allPost.unshift(temp);\r\n\r\n              }\r\n            }else{\r\n              console.log(\"No Post\")\r\n            }\r\n            \r\n          }else{\r\n            console.log(\"No post list\");\r\n          }\r\n        });\r\n        // ...\r\n        //real time lsiten to friends list\r\n        var db = getFirestore();\r\n        onSnapshot(doc(db, \"friends\",user.uid),(doc)=>{\r\n            console.log(\"Current Data: \",doc.data());\r\n            if(doc.data()){\r\n        \r\n                this.myFriends = doc.data().myFriends;\r\n            \r\n            }\r\n        });\r\n        //real time listen to friendrequest \r\n        onSnapshot(doc(db, \"friendrequest\",user.uid),(doc)=>{\r\n            console.log(\"Current Data: \",doc.data());\r\n            if(doc.data()){\r\n        \r\n                this.myFriendRequest = doc.data().request;\r\n            \r\n            }\r\n        });\r\n        //real time listen to post\r\n        onSnapshot(doc(db, \"post\",\"allpost\"),(doc)=>{\r\n            console.log(\"Current Data: \",doc.data());\r\n            if(doc.data().allPostItems.length !=0){\r\n                if(this.allPost.length != doc.data().allPostItems.length){\r\n                  var temp = doc.data().allPostItems.pop()\r\n                  this.allPost.unshift(temp);\r\n                }else{\r\n                  this.allPost = doc.data().allPostItems;\r\n                }\r\n            }\r\n        });\r\n    }else{\r\n      console.log(\"No user\");\r\n      window.location.href=\"/login\";\r\n    }\r\n    });\r\n  },\r\n}\r\nasync function getSearchUser(email){\r\n    var db = getFirestore();\r\n    var user\r\n    const querySnapshot = await getDocs(collection(db, \"users\"));\r\n    querySnapshot.forEach((doc) => {\r\n    //console.log(`${doc.id} => ${doc.data().email}`);\r\n    if(doc.data().email == email){\r\n      //console.log(doc.id);\r\n      user = {\r\n        uid : doc.id,\r\n        email : doc.data().email,\r\n        username : doc.data().username,\r\n        profilePic : doc.data().profilePic\r\n      }\r\n      //console.log(temp);\r\n      \r\n    }\r\n});\r\n    return user;\r\n}\r\nasync function  getData(uid,source){\r\n    //get all task that a uid have and return an array of taskitem objects\r\n    //if user yet to have any task, null will be returned \r\n    var db = getFirestore();\r\n    var result = null;\r\n    const querySnapshot = await getDocs(collection(db, source));\r\n    querySnapshot.forEach((doc) => {\r\n    //console.log(doc.data());\r\n    if(doc.id == uid){\r\n        result = doc.data();\r\n        console.log(result);\r\n    }\r\n\r\n    });\r\n    if(result != null && Object.values(result).length != 0){\r\n      if(source == \"tasklist\"){\r\n        return Object.values(result.taskItem);\r\n      }else if(source == \"friends\"){\r\n        console.log(result+\"Imhere!\")\r\n        return Object.values(result.myFriends);\r\n      }else if(source == \"friendrequest\"){\r\n        return Object.values(result.request);\r\n      }else if(source == \"post\"){\r\n        return Object.values(result.allPostItems);\r\n      }\r\n    \r\n    }\r\n    else{\r\n      return result;\r\n    }\r\n  \r\n}\r\nasync function updateDbTaskItem(uid,items){\r\n    //user to update the Task items to the uid given\r\n    var db = getFirestore();\r\n    console.log(items)\r\n    await setDoc(doc(db,\"tasklist\",uid),{\r\n      taskItem : items\r\n    });\r\n}\r\nasync function updateDbFriends(uid,items){\r\n    //update user's friend list\r\n    var db = getFirestore();\r\n    console.log(items)\r\n    await setDoc(doc(db,\"friends\",uid),{\r\n      myFriends : items\r\n    });\r\n}\r\nasync function sendDbFriendRequest(updatedRequest,friend){\r\n    var db = getFirestore();\r\n    console.log(friend);\r\n    await setDoc(doc(db,\"friendrequest\",friend.uid),{\r\n      request : updatedRequest\r\n    });\r\n}\r\nasync function updateDbPost(post){\r\n    var db = getFirestore();\r\n    console.log(post)\r\n    await setDoc(doc(db,\"post\",\"allpost\"),{\r\n      allPostItems : post\r\n    });\r\n    \r\n}\r\n</script>\r\n<style>\r\n#tasks{\r\n  background-image: linear-gradient(to right, #ffc107,#f5d77c);\r\n}\r\n#listfriend:hover{\r\n  background-color: aqua;\r\n}\r\n.button{\r\n  appearance: none;\r\n  outline: none;\r\n  border: none;\r\n  background: none;\r\n  cursor: pointer;\r\n\r\n  display: inline-block;\r\n  padding: 15px 25px;\r\n  background-image: linear-gradient(to right, #20c997,#16e6a7);\r\n  border-radius: 8px;\r\n  color: rgb(83, 72, 72);\r\n  font-size: 19px;\r\n  font-weight: 700;\r\n\r\n  box-shadow: 3px 3px rgba(0, 0, 0, 0.4);\r\n  transition: 0.4s ease-out;\r\n\r\n}\r\n.button:hover{\r\n  box-shadow: 6px 6px rgba(0, 0, 0, 0.6);\r\n}\r\n.modal-overlay{\r\n  position:fixed;\r\n  top:0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  z-index: 98;\r\n  background-color: rgba(0, 0, 0, 0.3);\r\n}\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n  transition: opacity 0.5s;;\r\n}\r\n.fade-enter,\r\n.fade-leave-to{\r\n  opacity: 0;\r\n}\r\n\r\n.popUp{\r\n  position: fixed;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%,-50%);\r\n  z-index: 99;\r\n\r\n  width: 100%;\r\n  max-width: 400px;\r\n  background-color:#fff;\r\n  border-radius: 16px;\r\n\r\n  padding: 25px;\r\n}\r\n.editProfile:hover{\r\n  border: 3px solid greenyellow;\r\n  width: 50px;\r\n  height: 50px;\r\n}\r\n@media only screen and (max-width: 789px) {\r\n  #friendlisthide{\r\n    display: none;\r\n  }\r\n}\r\n\r\n</style>"]}]}