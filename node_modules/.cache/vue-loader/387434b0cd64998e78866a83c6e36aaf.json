{"remainingRequest":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tianfeng/Desktop/BackUp with listeners/app/src/views/Messaging.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/src/views/Messaging.vue","mtime":1636819858465},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tianfeng/Desktop/BackUp with listeners/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldEF1dGggLCBvbkF1dGhTdGF0ZUNoYW5nZWR9IGZyb20gImZpcmViYXNlL2F1dGgiOwppbXBvcnQgeyBnZXRGaXJlc3RvcmUsIGRvYywgZ2V0RG9jcywgY29sbGVjdGlvbiAsIG9uU25hcHNob3QsIHNldERvY30gZnJvbSAnQGZpcmViYXNlL2ZpcmVzdG9yZSc7CmV4cG9ydCBkZWZhdWx0ewogICAgbmFtZTogJ2FwcCcsCiAgICBkYXRhKCl7CiAgICAgICAgcmV0dXJuewogICAgICAgICAgICB1c2VyOnsKICAgICAgICAgICAgICAgIHVpZCA6ICIiLAogICAgICAgICAgICAgICAgZW1haWwgOiAiIiwKICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogIiIsCiAgICAgICAgICAgICAgICBwcm9maWxlUGljIDogIiIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG15RnJpZW5kcyA6IFtdLAoKICAgICAgICAgICAgaW5wdXRNZXNzYWdlIDogIiIsCiAgICAgICAgICAgIHNob3dNZXNzYWdlIDpbXSwKICAgICAgICAgICAgY3VycmVudENoYXRGcmllbmQgOiBudWxsLAogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOnsKICAgICAgICBnZXRNZXNzYWdlKGZyaWVuZCl7CiAgICAgICAgICAgIHRoaXMuc2hvd01lc3NhZ2UgPVtdOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRDaGF0RnJpZW5kID0gZnJpZW5kOwogICAgICAgICAgICB2YXIgZGIgPSBnZXRGaXJlc3RvcmUoKTsKICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy51c2VyLnVpZCkKICAgICAgICAgICAgb25TbmFwc2hvdChkb2MoZGIsICJtZXNzYWdlcyIsdGhpcy51c2VyLnVpZCtmcmllbmQudWlkKSwoZG9jKT0+ewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkN1cnJlbnQgRGF0YTogIixkb2MuZGF0YSgpKTsKICAgICAgICAgICAgICAgIGlmKGRvYy5kYXRhKCkpewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd01lc3NhZ2UgPSBkb2MuZGF0YSgpLmNoYXRzOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5zY3JvbGxUb0JvdHRvbSwxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgIH0sCiAgICAgICAgc2VuZE1lc3NhZ2UoKXsKICAgICAgICAgICAgaWYodGhpcy5pbnB1dE1lc3NhZ2UudHJpbSgpID09ICIiKXsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vdmFyIGRiID0gZ2V0RmlyZXN0b3JlKCk7CiAgICAgICAgICAgIHZhciBuZXdBbGxNZXNzYWdlID1bXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciBuZXdNc2cgPSB7CiAgICAgICAgICAgICAgICBzZW5kZXIgOiB0aGlzLnVzZXIudWlkLAogICAgICAgICAgICAgICAgbWVzc2FnZSA6IHRoaXMuaW5wdXRNZXNzYWdlLAogICAgICAgICAgICAgICAgZGF0ZSA6IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc29sZS5sb2coIk5ldyBtZXNzYWdlOiIsbmV3TXNnKQogICAgICAgICAgICB2YXIgYWxsTWVzc2FnZSA9IGdldERhdGEodGhpcy51c2VyLnVpZCt0aGlzLmN1cnJlbnRDaGF0RnJpZW5kLnVpZCwibWVzc2FnZXMiKTsKICAgICAgICAgICAgYWxsTWVzc2FnZS50aGVuKChyZXN1bHQpPT57CiAgICAgICAgICAgICAgICBpZihyZXN1bHQgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaXRlbSBvZiByZXN1bHQpewogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyIDogaXRlbS5zZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlIDogaXRlbS5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA6IGl0ZW0uZGF0ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FsbE1lc3NhZ2UucHVzaCh0ZW1wKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gY2hhdCIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIGNoYXQgbGlzdCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbmV3QWxsTWVzc2FnZS5wdXNoKG5ld01zZyk7CiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlID0gc2VuZE1lc3NhZ2UodGhpcy5jdXJyZW50Q2hhdEZyaWVuZCx0aGlzLnVzZXIsbmV3QWxsTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB1cGRhdGUudGhlbigoKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJjaGF0IHVwZGF0ZWQiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRnJpZW5kID0gc2VuZE1lc3NhZ2UodGhpcy51c2VyLHRoaXMuY3VycmVudENoYXRGcmllbmQsbmV3QWxsTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRnJpZW5kLnRoZW4oKCk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImZyaWVuZCBjaGF0IHVwZGF0ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2U9IiI7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICBzY3JvbGxUb0JvdHRvbSgpewogICAgICAgICAgICB2YXIgbXlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdEhpc3RvcnkiKTsKICAgICAgICAgICAgbXlEaXYuc2Nyb2xsVG9wID0gbXlEaXYuc2Nyb2xsSGVpZ2h0OwogICAgICAgIH0KICAgIH0sCiAgICBiZWZvcmVDcmVhdGUoKXsKICAgICAgICBjb25zdCBhdXRoID0gZ2V0QXV0aCgpOwogICAgICAgIG9uQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCAodXNlcikgPT4gewogICAgICAgIGlmICh1c2VyKSB7CiAgICAgICAgICAgIC8vIFVzZXIgaXMgc2lnbmVkIGluLCBzZWUgZG9jcyBmb3IgYSBsaXN0IG9mIGF2YWlsYWJsZSBwcm9wZXJ0aWVzCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL3JlZmVyZW5jZS9qcy9maXJlYmFzZS5Vc2VyCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIudWlkKTsKICAgICAgICAgICAgZ2V0U2VhcmNoVXNlcih1c2VyLmVtYWlsKS50aGVuKChjdXJyZW50VXNlcik9PnsKICAgICAgICAgICAgICAgIHRoaXMudXNlciA9IGN1cnJlbnRVc2VyOwogICAgICAgICAgICB9KTsKCiAgICAgICAgLy9zdGFydCBnZXR0aW5nIGZyaWVuZCBsaXN0CiAgICAgICAgdmFyIGl0ZW1zID0gZ2V0RGF0YSh1c2VyLnVpZCwiZnJpZW5kcyIpOwogICAgICAgIGl0ZW1zLnRoZW4oKHJlc3VsdCk9PnsKICAgICAgICAgIGlmKHJlc3VsdCAhPSBudWxsKXsKICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsKICAgICAgICAgICAgICByZXN1bHQgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgICAgICAgIGZvcihsZXQgaXRlbSBvZiByZXN1bHQpewogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtKQogICAgICAgICAgICAgICAgZ2V0U2VhcmNoVXNlcihpdGVtLmVtYWlsKS50aGVuKCh1c2VyKT0+ewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gewogICAgICAgICAgICAgICAgICAgIHVpZCA6IHVzZXIudWlkLAogICAgICAgICAgICAgICAgICAgIGVtYWlsIDogdXNlci5lbWFpbCwKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA6IHVzZXIudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZVBpYyA6IHVzZXIucHJvZmlsZVBpYwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLm15RnJpZW5kcy5wdXNoKHRlbXApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gRnJpZW5kcyIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgY29uc29sZS5sb2coIk5vIEZyaWVuZGxpc3QiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsgLy9lbmQgZ2V0dGluZyBmcmllbmQgbGlzdAogICAgICAgICAgICAvLyAuLi4KICAgICAgICB9ZWxzZXsKICAgICAgICBjb25zb2xlLmxvZygiTm8gdXNlciIpOwogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPSIvbG9naW4iOwogICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KfQovLyBhc3luYyBmdW5jdGlvbiBnZXRVc2VyKHVpZCl7Ci8vICAgICB2YXIgZGIgPSBnZXRGaXJlc3RvcmUoKTsKLy8gICAgIHZhciBkb2NSZWYgPSBkb2MoZGIsInVzZXJzIix1aWQpOwovLyAgICAgdmFyIGRvY1NuYXAgPSBhd2FpdCBnZXREb2MoZG9jUmVmKTsKLy8gICAgIGlmKGRvY1NuYXAuZXhpc3RzKCkpewovLyAgICAgICAgIHJldHVybiBkb2NTbmFwLmRhdGEoKTsKLy8gICAgIH1lbHNlewovLyAgICAgICAgIHJldHVybiBmYWxzZTsKLy8gICAgIH0KLy8gfQphc3luYyBmdW5jdGlvbiAgZ2V0RGF0YSh1aWQsc291cmNlKXsKICAgIC8vZ2V0IGFsbCB0YXNrIHRoYXQgYSB1aWQgaGF2ZSBhbmQgcmV0dXJuIGFuIGFycmF5IG9mIHRhc2tpdGVtIG9iamVjdHMKICAgIC8vaWYgdXNlciB5ZXQgdG8gaGF2ZSBhbnkgdGFzaywgbnVsbCB3aWxsIGJlIHJldHVybmVkIAogICAgdmFyIGRiID0gZ2V0RmlyZXN0b3JlKCk7CiAgICB2YXIgcmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbGxlY3Rpb24oZGIsIHNvdXJjZSkpOwogICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHsKICAgIC8vY29uc29sZS5sb2coZG9jLmRhdGEoKSk7CiAgICBpZihkb2MuaWQgPT0gdWlkKXsKICAgICAgICByZXN1bHQgPSBkb2MuZGF0YSgpOwogICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICB9CgogICAgfSk7CiAgICBpZihyZXN1bHQgIT0gbnVsbCAmJiBPYmplY3QudmFsdWVzKHJlc3VsdCkubGVuZ3RoICE9IDApewogICAgICBpZihzb3VyY2UgPT0gImZyaWVuZHMiKXsKICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhyZXN1bHQubXlGcmllbmRzKTsKICAgICAgfWVsc2UgaWYoc291cmNlID09ICJtZXNzYWdlcyIpewogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdC5jaGF0cyk7CiAgICAgIH0KICAgIH0KICAgIGVsc2V7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgCn0KYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoZnJpZW5kLHVzZXIsbWVzc2FnZSl7CiAgICB2YXIgZGIgPSBnZXRGaXJlc3RvcmUoKTsKICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpCiAgICBhd2FpdCBzZXREb2MoZG9jKGRiLCJtZXNzYWdlcyIsdXNlci51aWQrZnJpZW5kLnVpZCksewogICAgICBjaGF0cyA6IG1lc3NhZ2UKICAgIH0pOwp9CmFzeW5jIGZ1bmN0aW9uIGdldFNlYXJjaFVzZXIoZW1haWwpewogICAgdmFyIGRiID0gZ2V0RmlyZXN0b3JlKCk7CiAgICB2YXIgdXNlcgogICAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgInVzZXJzIikpOwogICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHsKICAgIC8vY29uc29sZS5sb2coYCR7ZG9jLmlkfSA9PiAke2RvYy5kYXRhKCkuZW1haWx9YCk7CiAgICBpZihkb2MuZGF0YSgpLmVtYWlsID09IGVtYWlsKXsKICAgICAgLy9jb25zb2xlLmxvZyhkb2MuaWQpOwogICAgICB1c2VyID0gewogICAgICAgIHVpZCA6IGRvYy5pZCwKICAgICAgICBlbWFpbCA6IGRvYy5kYXRhKCkuZW1haWwsCiAgICAgICAgdXNlcm5hbWUgOiBkb2MuZGF0YSgpLnVzZXJuYW1lLAogICAgICAgIHByb2ZpbGVQaWMgOiBkb2MuZGF0YSgpLnByb2ZpbGVQaWMKICAgICAgfQogICAgICAvL2NvbnNvbGUubG9nKHRlbXApOwogICAgICAKICAgIH0KfSk7CiAgICByZXR1cm4gdXNlcjsKfQoK"},{"version":3,"sources":["Messaging.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Messaging.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div id=\"app\" class=\"container p-0\" style=\"width: 75%;\">\n\t\t<div class=\"card m-3\">\n\t\t\t<div class=\"row g-0\">\n\t\t\t\t<div class=\"chat-messages col-12 col-lg-5 col-xl-3 border bg-light\">\n\t\t\t\t\t<div class=\"px-4 d-none d-md-block\">\n\t\t\t\t\t\t<div class=\"d-flex align-items-center\">\n\t\t\t\t\t\t\t<div class=\"flex-grow-1\">\n\t\t\t\t\t\t\t\t<p>Chats</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<a v-for=\"(friend,key) in myFriends\" v-bind:key=\"key\" class=\"list-group-item list-group-item-action border\">\n\t\t\t\t\t\t<div class=\"d-flex align-items-start\">\n\t\t\t\t\t\t\t<div class=\"flex-grow-1 ml-3 text-start\" @click=\"getMessage(friend);\">\n\t\t\t\t\t\t\t\t<img :src=\"friend.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">{{friend.username}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t<hr class=\"d-block d-lg-none mt-1 mb-0\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"col-12 col-lg-7 col-xl-9 bg-light\" style=\"height:600px\">\n\t\t\t\t\t<div class=\"py-2 px-4 border-bottom d-none d-lg-block\">\n\t\t\t\t\t\t<div class=\"d-flex align-items-center py-1\">\n\t\t\t\t\t\t\t<div class=\"flex-grow-1 pl-3\">\n\t\t\t\t\t\t\t\t<strong v-if=\"currentChatFriend != null\">{{currentChatFriend.username}}</strong>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n                    <div id=\"chatHistory\" class=\"chat-messages\" style=\"height:500px\" @click=\"scrollToBottom\">\n                        <div v-for=\"(msg,key) in showMessage\" v-bind:key=\"key\" class=\"position-relative\">\n                            <div  class=\"chat-messages p-4\">\n                                <div v-if=\"msg.sender == user.uid \" class=\"chat-message-right pb-4\">\n                                    <div>\n                                        <img :src=\"user.profilePic\" class=\"rounded-circle mr-1\" alt=\"Chris Wood\" width=\"40\" height=\"40\">\n                                        <br>\n                                        <small class=\"text-muted small text-nowrap mt-2 text-end\">{{msg.date}}</small>\n                                    </div>\n                                    <div class=\"flex-shrink-1 bg-primary text-light rounded px-2 mr-3 w-50 h-50\" >\n                                        <div class=\" font-weight-bold text-end\">You</div>\n                                        <p class=\"text-start\">{{msg.message}}</p>\n                                    </div>\n                                    \n                                </div>\n                                <div v-else class=\"chat-message-left pb-4\">\n                                    <div>\n                                        <img :src=\"currentChatFriend.profilePic\" class=\"rounded-circle mr-1\" alt=\"Sharon Lessman\" width=\"40\" height=\"40\">\n                                        <br>\n                                        <small class=\"text-muted small text-nowrap mt-2 text-start\">{{msg.date}}</small>\n                                    </div>\n                                    <div class=\"flex-shrink-1 bg-success text-light rounded px-2 ml-3 w-50\">\n                                        <div class=\" font-weight-bold text-start\">{{currentChatFriend.username}}</div>\n                                        <p class=\"text-start\">{{msg.message}}</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n\t\t\t\t</div>\n                <div v-if =\"currentChatFriend != null\" class=\"flex-grow-0 py-3 px-4 border-top bg-light\">\n                    <div class=\"input-group\">\n                        <input type=\"text\" class=\"form-control\" placeholder=\"Type your message\" v-model=\"inputMessage\" v-on:keyup.enter=\"sendMessage\">\n                        <button v-if=\"inputMessage.trim() ==''\" class=\"btn btn-primary\" disabled>Send</button>\n                        <button v-else class=\"btn btn-primary\" @click=\"sendMessage()\">Send</button>\n                    </div>\n                </div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script>\nimport { getAuth , onAuthStateChanged} from \"firebase/auth\";\nimport { getFirestore, doc, getDocs, collection , onSnapshot, setDoc} from '@firebase/firestore';\nexport default{\n    name: 'app',\n    data(){\n        return{\n            user:{\n                uid : \"\",\n                email : \"\",\n                username : \"\",\n                profilePic : \"\",\n            },\n            myFriends : [],\n\n            inputMessage : \"\",\n            showMessage :[],\n            currentChatFriend : null,\n        }\n    },\n    methods:{\n        getMessage(friend){\n            this.showMessage =[];\n            this.currentChatFriend = friend;\n            var db = getFirestore();\n            console.log(this.user.uid)\n            onSnapshot(doc(db, \"messages\",this.user.uid+friend.uid),(doc)=>{\n                console.log(\"Current Data: \",doc.data());\n                if(doc.data()){\n                    this.showMessage = doc.data().chats;\n                    setTimeout(this.scrollToBottom,1000);\n                }\n            });\n            \n        },\n        sendMessage(){\n            if(this.inputMessage.trim() == \"\"){\n                return\n            }\n            //var db = getFirestore();\n            var newAllMessage =[];\n            \n            var newMsg = {\n                sender : this.user.uid,\n                message : this.inputMessage,\n                date : new Date().toDateString()\n            };\n            console.log(\"New message:\",newMsg)\n            var allMessage = getData(this.user.uid+this.currentChatFriend.uid,\"messages\");\n            allMessage.then((result)=>{\n                if(result != null){\n                    if(result.length != 0){\n                    result = Object.values(result);\n                    //console.log(result);\n                    for(let item of result){\n                        //console.log(item)\n                        var temp = {\n                            sender : item.sender,\n                            message : item.message,\n                            date : item.date\n                        }\n                        newAllMessage.push(temp);\n                    }\n                    }else{\n                        \n                        console.log(\"No chat\")\n                    }\n                    \n                }else{\n                    console.log(\"No chat list\");\n                }\n                newAllMessage.push(newMsg);\n                var update = sendMessage(this.currentChatFriend,this.user,newAllMessage);\n                update.then(()=>{\n                    console.log(\"chat updated\");\n                    var updateFriend = sendMessage(this.user,this.currentChatFriend,newAllMessage);\n                    updateFriend.then(()=>{\n                        console.log(\"friend chat updated\");\n                        this.inputMessage=\"\";\n                    })\n                });\n            });\n\n        },\n        scrollToBottom(){\n            var myDiv = document.getElementById(\"chatHistory\");\n            myDiv.scrollTop = myDiv.scrollHeight;\n        }\n    },\n    beforeCreate(){\n        const auth = getAuth();\n        onAuthStateChanged(auth, (user) => {\n        if (user) {\n            // User is signed in, see docs for a list of available properties\n            // https://firebase.google.com/docs/reference/js/firebase.User\n            console.log(user.uid);\n            getSearchUser(user.email).then((currentUser)=>{\n                this.user = currentUser;\n            });\n\n        //start getting friend list\n        var items = getData(user.uid,\"friends\");\n        items.then((result)=>{\n          if(result != null){\n            if(result.length != 0){\n              result = Object.values(result);\n              //console.log(result);\n              for(let item of result){\n                //console.log(item)\n                getSearchUser(item.email).then((user)=>{\n                    var temp = {\n                    uid : user.uid,\n                    email : user.email,\n                    username : user.username,\n                    profilePic : user.profilePic\n                    }\n                    this.myFriends.push(temp);\n                });\n              }\n            }else{\n              console.log(\"No Friends\")\n            }\n            \n          }else{\n            console.log(\"No Friendlist\");\n          }\n        }); //end getting friend list\n            // ...\n        }else{\n        console.log(\"No user\");\n        window.location.href=\"/login\";\n        }\n        });\n    }\n}\n// async function getUser(uid){\n//     var db = getFirestore();\n//     var docRef = doc(db,\"users\",uid);\n//     var docSnap = await getDoc(docRef);\n//     if(docSnap.exists()){\n//         return docSnap.data();\n//     }else{\n//         return false;\n//     }\n// }\nasync function  getData(uid,source){\n    //get all task that a uid have and return an array of taskitem objects\n    //if user yet to have any task, null will be returned \n    var db = getFirestore();\n    var result = null;\n    const querySnapshot = await getDocs(collection(db, source));\n    querySnapshot.forEach((doc) => {\n    //console.log(doc.data());\n    if(doc.id == uid){\n        result = doc.data();\n        console.log(result);\n    }\n\n    });\n    if(result != null && Object.values(result).length != 0){\n      if(source == \"friends\"){\n        return Object.values(result.myFriends);\n      }else if(source == \"messages\"){\n        return Object.values(result.chats);\n      }\n    }\n    else{\n      return result;\n    }\n  \n}\nasync function sendMessage(friend,user,message){\n    var db = getFirestore();\n    console.log(message)\n    await setDoc(doc(db,\"messages\",user.uid+friend.uid),{\n      chats : message\n    });\n}\nasync function getSearchUser(email){\n    var db = getFirestore();\n    var user\n    const querySnapshot = await getDocs(collection(db, \"users\"));\n    querySnapshot.forEach((doc) => {\n    //console.log(`${doc.id} => ${doc.data().email}`);\n    if(doc.data().email == email){\n      //console.log(doc.id);\n      user = {\n        uid : doc.id,\n        email : doc.data().email,\n        username : doc.data().username,\n        profilePic : doc.data().profilePic\n      }\n      //console.log(temp);\n      \n    }\n});\n    return user;\n}\n\n</script>\n<style>\n.chat-messages {\n    display: flex-box;\n    flex-direction: row-reverse;\n    max-height: 800px;\n    overflow: auto;\n}\n\n.chat-message-left,\n.chat-message-right {\n    display: flex;\n    flex-shrink: 0\n}\n\n.chat-message-left {\n    margin-right: auto\n}\n\n.chat-message-right {\n    flex-direction: row-reverse;\n    margin-left: auto\n}\n.py-3 {\n    padding-top: 1rem!important;\n    padding-bottom: 1rem!important;\n}\n.px-4 {\n    padding-right: 1.5rem!important;\n    padding-left: 1.5rem!important;\n}\n.flex-grow-0 {\n    flex-grow: 0!important;\n}\n.border-top {\n    border-top: 1px solid #dee2e6!important;\n}\n</style>"]}]}